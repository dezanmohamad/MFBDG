<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Muslim Footballers Bandung</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@400;500;600;700&family=Oswald:wght@500;700&display=swap" rel="stylesheet">
  
  <style>
    body { box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
    .font-arabic { font-family: 'Amiri', serif; }
    .font-head { font-family: 'Oswald', sans-serif; }
    
    .glass-effect { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(218, 165, 32, 0.2); }
    .glass-nav { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.5); box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
    
    .gold-gradient { background: linear-gradient(135deg, #DAA520 0%, #FFD700 100%); }
    .platinum-gradient { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 1px solid #475569; }
    
    .hover-lift { transition: all 0.3s ease; }
    .hover-lift:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(218, 165, 32, 0.3); }
    
    /* Menu Styles */
    .menu-item { 
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
        cursor: pointer; 
        position: relative;
        overflow: hidden;
    }
    .menu-item:hover { background-color: rgba(218, 165, 32, 0.1); }
    
    /* Active State */
    .menu-item.active { 
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); 
        color: white; 
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(15, 23, 42, 0.2);
        border: 1px solid rgba(218, 165, 32, 0.3);
    }
    
    .menu-item.active::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(90deg, #DAA520, #FFD700);
    }
    
    .islamic-pattern { 
        background-color: #fdfbf7;
        background-image: radial-gradient(#DAA520 0.5px, transparent 0.5px), radial-gradient(#DAA520 0.5px, #fdfbf7 0.5px);
        background-size: 20px 20px;
        background-position: 0 0, 10px 10px;
    }

    /* Logic Admin */
    .admin-only { display: none !important; }
    body.is-admin .admin-only { display: block !important; }
    body.is-admin div.flex.admin-only { display: flex !important; } 
    body.is-admin label.admin-only { display: flex !important; }
    body.is-admin .admin-grid { display: grid !important; }

    .admin-toggle { 
        position: fixed; 
        bottom: 30px; 
        left: 30px; 
        z-index: 99999; 
        font-size: 24px; 
        cursor: pointer; 
        background: linear-gradient(135deg, #DAA520 0%, #FFD700 100%); 
        width: 60px; 
        height: 60px; 
        border-radius: 50%; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.3); 
        transition: all 0.3s ease; 
        border: 3px solid white; 
    }
    .admin-toggle:hover { transform: scale(1.1) rotate(15deg); }
    
    /* Toast Notification */
    .toast { animation: fadeIn 0.3s, fadeOut 0.3s 2.5s forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-20px); } }
    
    /* Scrollbars */
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 4px; }
    .scrollbar-dark::-webkit-scrollbar { width: 8px; }
    .scrollbar-dark::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); }
    .scrollbar-dark::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }
  </style>
 </head>
 <body class="h-full islamic-pattern text-slate-800">
  <div id="app" class="h-full w-full overflow-auto">
    
   <header class="glass-effect shadow-sm sticky top-0 z-50 border-b border-amber-100/50">
    <div class="max-w-7xl mx-auto px-4 py-3 md:py-4">
     <div class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-3 flex-shrink-0 cursor-pointer" onclick="showMenu('dashboard')">
        <div class="w-10 h-10 bg-gradient-to-br from-slate-800 to-slate-900 rounded-full flex items-center justify-center text-white text-xl shadow-lg border-2 border-amber-400">âš½</div>
        <div class="hidden md:block">
           <h1 id="appTitle" class="text-lg md:text-2xl font-bold text-slate-900 font-head tracking-wide uppercase">Muslim Footballers <span class="text-amber-600">BDG</span></h1>
           <p id="greetingText" class="text-[10px] md:text-xs text-amber-700 font-bold font-arabic tracking-wider">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…</p>
        </div>
      </div>
      
      <div class="flex-1 max-w-md">
          <div class="relative group">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <span class="text-gray-400 group-focus-within:text-amber-500 transition-colors">ğŸ”</span>
              </div>
              <input type="text" id="globalSearchInput" onkeyup="handleGlobalSearch()" 
                     class="block w-full pl-10 pr-3 py-2 border border-gray-200 rounded-full leading-5 bg-gray-50 placeholder-gray-400 focus:outline-none focus:bg-white focus:ring-2 focus:ring-amber-400 focus:border-transparent transition-all sm:text-sm shadow-inner" 
                     placeholder="Cari Pemain, Aset, atau Sponsor...">
          </div>
      </div>

      <div class="text-right hidden md:block flex-shrink-0">
       <div class="text-sm font-bold text-slate-700" id="currentDate"></div>
       <div class="text-xs text-amber-600 font-semibold" id="hijriDate">1446 H</div>
      </div>
     </div>
    </div>
   </header>

   <div class="max-w-7xl mx-auto px-4 pt-4 pb-2 sticky top-[70px] z-40">
    <div class="glass-nav rounded-2xl p-2 shadow-lg">
        <div class="flex md:grid md:grid-cols-9 gap-2 overflow-x-auto pb-1 md:pb-0 hide-scrollbar" style="-webkit-overflow-scrolling: touch;">
            <div class="menu-item rounded-xl p-2 min-w-[80px] text-center active flex-shrink-0" data-menu="dashboard">
                <div class="text-xl mb-1 filter drop-shadow-sm">ğŸ“Š</div><div class="text-[10px] font-bold uppercase tracking-wider">Beranda</div>
            </div>
            <div class="menu-item rounded-xl p-2 min-w-[80px] text-center flex-shrink-0" data-menu="islami">
                <div class="text-xl mb-1 filter drop-shadow-sm">ğŸ•Œ</div><div class="text-[10px] font-bold uppercase tracking-wider">Islami</div>
            </div>
            <div class="menu-item rounded-xl p-2 min-w-[80px] text-center flex-shrink-0" data-menu="anggota">
                <div class="text-xl mb-1 filter drop-shadow-sm">ğŸ‘¥</div><div class="text-[10px] font-bold uppercase tracking-wider">Squad</div>
            </div>
            <div class="menu-item rounded-xl p-2 min-w-[80px] text-center flex-shrink-0" data-menu="jadwal">
                <div class="text-xl mb-1 filter drop-shadow-sm">ğŸ“…</div><div class="text-[10px] font-bold uppercase tracking-wider">Jadwal</div>
            </div>
            <div class="menu-item rounded-xl p-2 min-w-[80px] text-center flex-shrink-0" data-menu="match">
                <div class="text-xl mb-1 filter drop-shadow-sm">âš½</div><div class="text-[10px] font-bold uppercase tracking-wider">Match</div>
            </div>
            <div class="menu-item rounded-xl p-2 min-w-[80px] text-center flex-shrink-0" data-menu="statistik">
                <div class="text-xl mb-1 filter drop-shadow-sm">ğŸ“ˆ</div><div class="text-[10px] font-bold uppercase tracking-wider">Stats</div>
            </div>
            <div class="menu-item rounded-xl p-2 min-w-[80px] text-center flex-shrink-0" data-menu="inventaris">
                <div class="text-xl mb-1 filter drop-shadow-sm">ğŸ“¦</div><div class="text-[10px] font-bold uppercase tracking-wider">Aset</div>
            </div>
            <div class="menu-item rounded-xl p-2 min-w-[80px] text-center flex-shrink-0" data-menu="sponsor">
                <div class="text-xl mb-1 filter drop-shadow-sm">ğŸ¤</div><div class="text-[10px] font-bold uppercase tracking-wider">Sponsor</div>
            </div>
            <div class="menu-item rounded-xl p-2 min-w-[80px] text-center flex-shrink-0" data-menu="galeri">
                <div class="text-xl mb-1 filter drop-shadow-sm">ğŸ“·</div><div class="text-[10px] font-bold uppercase tracking-wider">Galeri</div>
            </div>
        </div>
    </div>
   </div>

   <main class="max-w-7xl mx-auto px-4 pb-24 pt-4">
    
   <div id="dashboardView" class="view-content"> 
    <div class="mb-8">
     <div class="relative rounded-3xl overflow-hidden shadow-2xl bg-slate-900 border border-white/10 min-h-[280px] flex flex-col justify-center">
        <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1556056504-5c7696c4c28d?q=80&w=2000')] bg-cover bg-center opacity-30"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/60 to-transparent"></div>
        
        <div class="relative p-6 text-white text-center">
            <div class="flex justify-center items-center gap-2 mb-2">
                <span class="bg-amber-500 text-slate-900 text-[10px] font-bold px-3 py-1 rounded-full uppercase animate-pulse">Next Match</span>
                <span id="nextMatchDate" class="text-xs text-gray-300 font-medium">Memuat jadwal...</span>
            </div>
            <h2 id="nextMatchTitle" class="text-2xl md:text-5xl font-head font-bold mb-6 uppercase italic leading-tight">Menunggu Jadwal</h2>
            
            <div class="flex justify-center items-center gap-2 md:gap-4 mb-8">
                <div class="bg-white/10 backdrop-blur-md rounded-xl p-2 min-w-[65px] border border-white/10">
                    <div class="text-2xl font-bold font-mono text-amber-400" id="countdownDays">00</div>
                    <div class="text-[8px] uppercase text-gray-300">Hari</div>
                </div>
                <div class="text-lg font-bold text-white/30">:</div>
                <div class="bg-white/10 backdrop-blur-md rounded-xl p-2 min-w-[65px] border border-white/10">
                    <div class="text-2xl font-bold font-mono text-amber-400" id="countdownHours">00</div>
                    <div class="text-[8px] uppercase text-gray-300">Jam</div>
                </div>
                <div class="text-lg font-bold text-white/30">:</div>
                <div class="bg-white/10 backdrop-blur-md rounded-xl p-2 min-w-[65px] border border-white/10">
                    <div class="text-2xl font-bold font-mono text-amber-400" id="countdownMinutes">00</div>
                    <div class="text-[8px] uppercase text-gray-300">Menit</div>
                </div>
                <div class="text-lg font-bold text-white/30">:</div>
                <div class="bg-white/10 backdrop-blur-md rounded-xl p-2 min-w-[65px] border border-white/10">
                    <div class="text-2xl font-bold font-mono text-amber-400" id="countdownSeconds">00</div>
                    <div class="text-[8px] uppercase text-gray-300">Detik</div>
                </div>
            </div>

            <button onclick="showMenu('jadwal')" class="bg-amber-500 hover:bg-amber-400 text-slate-900 px-8 py-2.5 rounded-full text-xs font-bold transition-all shadow-lg transform active:scale-95 mx-auto block">
                Lihat Detail Jadwal â†’
            </button>
        </div>
    </div>
  </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        <div class="bg-gradient-to-br from-blue-600 to-blue-800 p-5 rounded-2xl shadow-lg shadow-blue-500/20 text-white relative overflow-hidden group hover-lift cursor-pointer border border-blue-500/30" onclick="showMenu('anggota')">
            <div class="absolute -right-4 -bottom-4 text-9xl text-white opacity-10 transform rotate-12 transition-transform group-hover:scale-110">ğŸ‘¥</div>
            <div class="relative z-10">
                <div class="text-[10px] font-bold bg-white/20 text-blue-100 inline-block px-2 py-1 rounded mb-3 shadow-sm backdrop-blur">SQUAD TIM</div>
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center font-bold text-2xl border border-white/20 shadow-inner">ğŸ‘•</div>
                    <div>
                        <h3 id="totalAnggota" class="text-3xl font-bold font-head leading-none text-white">0</h3>
                        <p class="text-xs font-semibold text-blue-100 opacity-80">Pemain Terdaftar</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-gradient-to-br from-purple-600 to-purple-800 p-5 rounded-2xl shadow-lg shadow-purple-500/20 text-white relative overflow-hidden group hover-lift cursor-pointer border border-purple-500/30" onclick="showMenu('match')">
            <div class="absolute -right-4 -bottom-4 text-9xl text-white opacity-10 transform rotate-12 transition-transform group-hover:scale-110">âš½</div>
            <div class="relative z-10">
                <div class="text-[10px] font-bold bg-white/20 text-purple-100 inline-block px-2 py-1 rounded mb-3 shadow-sm backdrop-blur">MATCHES</div>
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center font-bold text-2xl border border-white/20 shadow-inner">ğŸŸï¸</div>
                    <div>
                        <h3 id="totalMatches" class="text-3xl font-bold font-head leading-none text-white">0</h3>
                        <p class="text-xs font-semibold text-purple-100 opacity-80">Laga Dimainkan</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-gradient-to-br from-amber-500 to-orange-600 p-5 rounded-2xl shadow-lg shadow-amber-500/20 text-white relative overflow-hidden group hover-lift cursor-pointer border border-amber-500/30" onclick="showMenu('statistik')">
             <div class="absolute -right-4 -bottom-4 text-9xl text-white opacity-10 transform rotate-12 transition-transform group-hover:scale-110">ğŸ‘‘</div>
             <div class="relative z-10">
                <div class="text-[10px] font-bold bg-black/20 text-amber-100 inline-block px-2 py-1 rounded mb-3 shadow-sm backdrop-blur">TOP SCORER</div>
                <div class="flex items-center gap-4">
                    <div id="topScorerAvatar" class="w-12 h-12 rounded-full bg-white text-orange-600 flex items-center justify-center font-bold text-xl border-2 border-orange-300 shadow-lg">?</div>
                    <div class="overflow-hidden">
                        <h3 id="topScorer" class="text-xl font-bold font-head leading-none text-white truncate w-full">Belum Ada</h3>
                        <p id="topScorerGoals" class="text-xs font-semibold opacity-90 mt-1">0 Goals</p>
                    </div>
                </div>
             </div>
        </div>
        <div class="bg-gradient-to-br from-cyan-500 to-teal-600 p-5 rounded-2xl shadow-lg shadow-cyan-500/20 text-white relative overflow-hidden group hover-lift cursor-pointer border border-cyan-500/30" onclick="showMenu('statistik')">
            <div class="absolute -right-4 -bottom-4 text-9xl text-white opacity-10 transform rotate-12 transition-transform group-hover:scale-110">ğŸ¯</div>
            <div class="relative z-10">
               <div class="text-[10px] font-bold bg-black/20 text-cyan-100 inline-block px-2 py-1 rounded mb-3 shadow-sm backdrop-blur">TOP ASSIST</div>
               <div class="flex items-center gap-4">
                   <div id="topAssistAvatar" class="w-12 h-12 rounded-full bg-white text-teal-600 flex items-center justify-center font-bold text-xl border-2 border-teal-300 shadow-lg">?</div>
                   <div class="overflow-hidden">
                       <h3 id="topAssist" class="text-xl font-bold font-head leading-none text-white truncate w-full">Belum Ada</h3>
                       <p id="topAssistCount" class="text-xs font-semibold opacity-90 mt-1">0 Assists</p>
                   </div>
               </div>
            </div>
       </div>
      </div>
    </div>

    <div id="islamiView" class="view-content hidden">
      <div class="relative rounded-2xl overflow-hidden mb-6 shadow-xl border border-green-200">
          <div class="absolute inset-0 bg-gradient-to-r from-emerald-800 to-green-600"></div>
          <div class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/arabesque.png')]"></div>
          <div class="relative p-6 text-white flex flex-col md:flex-row items-center justify-between">
              <div class="mb-4 md:mb-0">
                  <h2 class="text-2xl md:text-3xl font-bold font-head">Islamic Center</h2>
                  <p class="text-green-100 text-sm">Pusat Spiritual Muslim Footballers Bandung</p>
              </div>
              <div class="text-right">
                  <div class="text-4xl font-arabic font-bold text-amber-300" id="hijriDateDisplay">1446 H</div>
                  <div class="text-xs text-green-200 uppercase tracking-widest">Tahun Hijriah</div>
              </div>
          </div>
      </div>

      <div class="mb-6">
          <div class="flex items-center justify-between mb-3 px-1">
            <h3 class="text-lg font-bold text-emerald-800 flex items-center gap-2"><span class="text-xl">ğŸ•Œ</span> Waktu Sholat Bandung</h3>
            <span class="text-xs text-gray-500 bg-white px-2 py-1 rounded shadow-sm">Sumber: Kemenag</span>
          </div>
          <div id="prayerSchedule" class="grid grid-cols-2 md:grid-cols-5 gap-3"></div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
        <div class="lg:col-span-2 glass-effect rounded-xl p-0 overflow-hidden shadow-lg border-t-4 border-amber-500">
            <div class="bg-amber-50 p-4 border-b border-amber-100 flex justify-between items-center">
                <h3 class="font-bold text-amber-800 flex items-center gap-2">ğŸ’ Renungan Hari Ini</h3>
                <button onclick="refreshRenungan()" class="text-xs bg-white border border-amber-300 px-3 py-1 rounded-full hover:bg-amber-100 text-amber-700 transition shadow-sm">ğŸ”„ Refresh Ayat</button>
            </div>
            <div class="p-6 md:p-8 bg-[url('https://www.transparenttextures.com/patterns/cream-paper.png')]">
                 <div class="mb-6 text-center">
                    <p class="text-xs text-gray-500 mb-2 tracking-widest uppercase">Kalamullah (Random)</p>
                    <div id="ayatContainer">
                        <p id="ayatText" class="text-2xl md:text-3xl font-arabic text-slate-800 leading-loose mb-4" style="line-height: 2.2;">Sedang memuat ayat...</p>
                        <p id="ayatTranslation" class="text-sm text-gray-600 italic border-l-2 border-amber-400 pl-4 inline-block"></p>
                    </div>
                 </div>
                 <div class="bg-emerald-50 p-4 rounded-lg border border-emerald-100 relative">
                    <span class="absolute -top-3 left-4 bg-emerald-600 text-white text-[10px] px-2 py-0.5 rounded uppercase font-bold">Hadist Pilihan</span>
                    <p id="hadistText" class="text-sm text-emerald-900 leading-relaxed font-medium mt-1"></p>
                 </div>
            </div>
        </div>

        <div class="space-y-6">
             <div class="glass-effect rounded-xl p-5 shadow-md">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-emerald-700 flex items-center gap-2">ğŸ¤² Doa Harian Online</h3>
                    <button onclick="getOnlineDoa()" class="text-xs text-emerald-600 hover:text-emerald-800 font-semibold bg-emerald-50 px-2 py-1 rounded">ğŸ”„ Reload</button>
                </div>
                <div id="doaListContainer" class="space-y-2 max-h-[300px] overflow-y-auto pr-1">
                    <div class="text-center py-4 text-gray-500 text-sm animate-pulse">Mengambil data doa online...</div>
                </div>
             </div>
             <div class="bg-slate-800 text-white rounded-xl p-5 shadow-lg relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl">ğŸ§­</div>
                <h3 class="text-sm font-bold text-gray-400 uppercase mb-1">Arah Kiblat</h3>
                <div class="flex items-center gap-4 mt-2">
                    <div class="text-3xl font-bold text-amber-400">295Â°</div>
                    <div class="text-xs text-gray-300">Barat Laut<br>dari Bandung</div>
                </div>
             </div>
        </div>
      </div>

      <div class="glass-effect rounded-xl p-6 admin-only">
        <h2 class="text-xl font-bold text-amber-600 mb-4 flex items-center gap-2"><span>ğŸ“š</span> Kelola Jadwal Kajian</h2>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-4">
            <input type="text" id="kajianTopic" placeholder="Topik Kajian" class="px-4 py-2 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-400"> 
            <input type="date" id="kajianDate" class="px-4 py-2 border border-amber-300 rounded-lg"> 
            <input type="time" id="kajianTime" class="px-4 py-2 border border-amber-300 rounded-lg"> 
            <input type="text" id="kajianSpeaker" placeholder="Pemateri/Ustadz" class="px-4 py-2 border border-amber-300 rounded-lg">
        </div>
        <button onclick="addKajian()" class="w-full gold-gradient text-white px-4 py-3 rounded-lg hover:opacity-90 font-semibold shadow-md transform active:scale-95 transition"> â• Tambah Jadwal Kajian </button>
      </div>
      
      <div class="mt-6">
        <h3 class="text-lg font-bold text-slate-700 mb-4 px-1">Agenda Kajian Rutin</h3>
        <div id="kajianList" class="space-y-3"></div>
      </div>
    </div>

    <div id="anggotaView" class="view-content hidden">
      <div class="relative rounded-2xl overflow-hidden mb-8 shadow-xl bg-slate-900 text-white min-h-[200px] flex items-center">
          <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1579952363873-27f3bade9f55?q=80&w=2000')] bg-cover bg-center opacity-40"></div>
          <div class="absolute inset-0 bg-gradient-to-r from-slate-900 via-slate-900/80 to-transparent"></div>
          <div class="relative p-8 z-10 max-w-2xl">
              <span class="text-amber-400 font-bold tracking-widest text-xs uppercase mb-2 block">Daftar Pemain Resmi</span>
              <h2 class="text-4xl md:text-5xl font-head font-bold leading-tight mb-2">The Squad</h2>
              <p class="text-gray-300 text-sm mb-6 max-w-md">Barisan pejuang lapangan hijau. Menjunjung tinggi sportivitas dan ukhuwah islamiyah.</p>
              <button onclick="document.getElementById('joinFormSection').scrollIntoView({behavior: 'smooth'})" class="admin-only bg-amber-500 hover:bg-amber-600 text-slate-900 px-6 py-2 rounded-full font-bold text-sm transition shadow-lg transform hover:scale-105">Gabung Tim</button>
          </div>
      </div>

      <div class="mb-10">
          <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2 border-l-4 border-amber-500 pl-3">
              <span>ğŸ‘¥</span> Galeri Pemain
          </h3>
          <div class="flex items-center justify-between mb-4 px-2">
              <span class="text-xs text-gray-500 font-semibold" id="totalPlayerCount">Memuat pemain...</span>
              <div class="admin-only flex gap-2">
                 <button onclick="exportMembersCSV()" class="bg-green-100 text-green-700 px-3 py-1 rounded-lg text-xs font-bold hover:bg-green-200">ğŸ“¥ CSV</button> 
                 <label class="bg-blue-100 text-blue-700 px-3 py-1 rounded-lg text-xs font-bold hover:bg-blue-200 cursor-pointer">ğŸ“¤ Import <input type="file" accept=".csv" onchange="processImport(event)" class="hidden"></label>
              </div>
          </div>
          <div id="memberList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"></div>
      </div>

      <div id="joinFormSection" class="admin-only bg-white rounded-2xl p-6 shadow-lg border border-gray-100 relative overflow-hidden">
         <div class="absolute top-0 right-0 p-10 opacity-5 text-9xl rotate-12">ğŸ“</div>
         <div class="relative z-10">
             <h2 class="text-2xl font-bold text-slate-800 mb-2 font-head">Formulir Pendaftaran</h2>
             <p class="text-gray-500 text-sm mb-6">Isi data diri Anda dengan lengkap untuk bergabung.</p>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-5">
                 <div class="col-span-1 md:col-span-2"><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Nama Lengkap</label><input type="text" id="memberName" placeholder="Masukkan nama..." class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-400 bg-gray-50"></div>
                 <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Posisi Utama</label><select id="memberPosition" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-400 bg-white"><option value="Gelandang">Gelandang (MID)</option><option value="Striker">Striker (FWD)</option><option value="Bek">Bek (DEF)</option><option value="Kiper">Kiper (GK)</option></select></div>
                 <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Nomor WhatsApp</label><input type="tel" id="memberPhone" placeholder="08..." class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-400 bg-gray-50"></div>
                 <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Skill Level</label><select id="memberSkill" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-400 bg-white"><option value="Pemula">â­ Pemula</option><option value="Menengah">â­â­ Menengah</option><option value="Mahir">â­â­â­ Mahir</option></select></div>
                 <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">URL Foto Profil (Opsional)</label><input type="text" id="memberPhoto" placeholder="https://..." class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-400 bg-gray-50"></div>
                 <div class="col-span-1 md:col-span-2"><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Ketersediaan</label><select id="memberAvailability" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-400 bg-white"><option value="Fleksibel">Fleksibel</option><option value="Weekend">Weekend Only</option><option value="Weekday">Weekday Only</option></select></div>
             </div>
             <button onclick="addMember()" class="w-full bg-gradient-to-r from-amber-500 to-amber-600 text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-amber-500/30 transform hover:-translate-y-1 transition-all"> â• Simpan Data Pemain </button>
         </div>
      </div>
    </div>

    <div id="jadwalView" class="view-content hidden">
      <div class="relative rounded-2xl overflow-hidden mb-8 shadow-xl bg-slate-900 text-white min-h-[200px] flex items-center">
          <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1522778119026-d647f0565c6d?q=80&w=2000')] bg-cover bg-center opacity-40"></div>
          <div class="absolute inset-0 bg-gradient-to-r from-slate-900 via-slate-900/80 to-transparent"></div>
          <div class="relative p-8 z-10 max-w-2xl">
              <span class="text-amber-400 font-bold tracking-widest text-xs uppercase mb-2 block">Kalender Kegiatan</span>
              <h2 class="text-3xl md:text-4xl font-head font-bold leading-tight mb-4">Jadwal Pertandingan <br>& Latihan</h2>
              <p class="text-gray-300 text-sm mb-6">Jangan lewatkan setiap momen perjuangan tim. Catat tanggalnya!</p>
              <button onclick="document.getElementById('scheduleSectionAdmin').scrollIntoView({behavior: 'smooth'})" class="admin-only bg-amber-500 hover:bg-amber-600 text-slate-900 px-6 py-2 rounded-full font-bold text-sm transition shadow-lg">Tambah Jadwal</button>
          </div>
      </div>

      <div class="mb-10">
          <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2 border-l-4 border-amber-500 pl-3">
              <span>ğŸ“…</span> Agenda Mendatang
          </h3>
          <div id="scheduleList" class="space-y-6"></div>
      </div>

      <div id="scheduleSectionAdmin" class="glass-effect rounded-xl p-6 mb-6 admin-only border border-amber-200">
       <h2 class="text-xl font-bold text-amber-600 mb-4">ğŸ“… Buat Jadwal Baru</h2>
       <div class="mb-4"><select id="scheduleType" class="w-full px-4 py-3 border border-amber-300 rounded-xl bg-white font-semibold text-gray-700 focus:ring-2 focus:ring-amber-400"> <option value="">-- Pilih Jenis Kegiatan --</option> <option value="Friendly Match">ğŸ¤ Friendly Match</option> <option value="Fun Football">âš½ Fun Football Internal</option> </select></div>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><input type="text" id="scheduleName" placeholder="Nama Lawan / Kegiatan" class="px-4 py-3 border border-amber-300 rounded-xl focus:ring-2 focus:ring-amber-400"> <input type="date" id="scheduleDate" class="px-4 py-3 border border-amber-300 rounded-xl focus:ring-2 focus:ring-amber-400"></div>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><input type="time" id="scheduleTime" class="px-4 py-3 border border-amber-300 rounded-xl focus:ring-2 focus:ring-amber-400"> <input type="text" id="scheduleLocation" placeholder="Lokasi Lapangan" class="px-4 py-3 border border-amber-300 rounded-xl focus:ring-2 focus:ring-amber-400"></div><button onclick="addSchedule()" class="w-full gold-gradient text-white px-4 py-3 rounded-xl hover:opacity-90 font-semibold shadow-md transform active:scale-95 transition"> ğŸ’¾ Simpan Jadwal </button>
      </div>
    </div>

    <div id="matchView" class="view-content hidden">
      <div class="relative rounded-2xl overflow-hidden mb-8 shadow-xl bg-slate-900 text-white min-h-[200px] flex items-center">
          <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1574629810360-7efbbe195018?q=80&w=2000')] bg-cover bg-center opacity-40"></div>
          <div class="absolute inset-0 bg-gradient-to-r from-slate-900 via-slate-900/80 to-transparent"></div>
          <div class="relative p-8 z-10 max-w-2xl">
              <span class="text-amber-400 font-bold tracking-widest text-xs uppercase mb-2 block">Scoreboard & History</span>
              <h2 class="text-3xl md:text-4xl font-head font-bold leading-tight mb-4">Hasil Pertandingan</h2>
              <p class="text-gray-300 text-sm mb-6">Rekam jejak perjuangan di lapangan hijau. Menang kami syukuri, kalah kami evaluasi.</p>
              <button onclick="document.getElementById('matchInputSection').scrollIntoView({behavior: 'smooth'})" class="admin-only bg-amber-500 hover:bg-amber-600 text-slate-900 px-6 py-2 rounded-full font-bold text-sm transition shadow-lg transform hover:scale-105">Input Skor</button>
          </div>
      </div>

      <div class="grid grid-cols-3 gap-3 mb-8">
          <div class="bg-gradient-to-br from-green-600 to-green-700 rounded-xl p-4 text-white shadow-lg relative overflow-hidden group hover-lift border border-green-500/30">
              <div class="absolute -right-2 -top-2 opacity-10 text-6xl font-bold font-head group-hover:scale-110 transition-transform">W</div>
              <div class="relative z-10">
                  <div class="text-[10px] font-bold uppercase tracking-widest opacity-80 mb-1">Menang</div>
                  <div id="summaryWin" class="text-3xl md:text-4xl font-head font-bold">0</div>
              </div>
          </div>
          <div class="bg-gradient-to-br from-slate-600 to-slate-700 rounded-xl p-4 text-white shadow-lg relative overflow-hidden group hover-lift border border-slate-500/30">
              <div class="absolute -right-2 -top-2 opacity-10 text-6xl font-bold font-head group-hover:scale-110 transition-transform">D</div>
              <div class="relative z-10">
                  <div class="text-[10px] font-bold uppercase tracking-widest opacity-80 mb-1">Seri</div>
                  <div id="summaryDraw" class="text-3xl md:text-4xl font-head font-bold">0</div>
              </div>
          </div>
          <div class="bg-gradient-to-br from-red-600 to-red-700 rounded-xl p-4 text-white shadow-lg relative overflow-hidden group hover-lift border border-red-500/30">
              <div class="absolute -right-2 -top-2 opacity-10 text-6xl font-bold font-head group-hover:scale-110 transition-transform">L</div>
              <div class="relative z-10">
                  <div class="text-[10px] font-bold uppercase tracking-widest opacity-80 mb-1">Kalah</div>
                  <div id="summaryLoss" class="text-3xl md:text-4xl font-head font-bold">0</div>
              </div>
          </div>
      </div>

      <div class="mb-10">
          <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2 border-l-4 border-amber-500 pl-3">
              <span>ğŸ†</span> Riwayat Laga
          </h3>
          <div id="matchList" class="space-y-4"></div>
      </div>

      <div id="matchInputSection" class="glass-effect rounded-xl p-6 mb-6 admin-only border border-amber-200">
        <h2 class="text-xl font-bold text-amber-600 mb-4 flex items-center gap-2"><span>âš½</span> Input Hasil Pertandingan</h2>
        
        <div class="mb-4">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">1. Pilih Jadwal Pertandingan</label>
            <select id="matchScheduleRef" onchange="renderMatchInputForm()" class="w-full px-4 py-3 border border-amber-300 rounded-xl focus:ring-2 focus:ring-amber-400 bg-amber-50 font-bold text-slate-700">
                <option value="">-- Pilih Jadwal --</option>
            </select>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <select id="matchType" onchange="renderMatchInputForm()" class="px-4 py-3 border border-amber-300 rounded-xl bg-white font-bold text-gray-700"> 
                <option value="">-- Jenis Match --</option> 
                <option value="Friendly Match">ğŸ¤ Friendly Match</option> 
                <option value="Fun Football">ğŸ† Fun Football (Internal)</option> 
            </select>
            <input type="date" id="matchDate" class="px-4 py-3 border border-amber-300 rounded-xl bg-gray-100" readonly>
        </div>
        
        <div class="mb-4">
            <input type="text" id="matchLocation" placeholder="Lokasi" class="w-full px-4 py-3 border border-amber-300 rounded-xl bg-gray-100" readonly>
            <input type="text" id="matchOpponent" placeholder="Nama Lawan" class="w-full mt-2 px-4 py-3 border border-amber-300 rounded-xl hidden">
        </div>

        <div id="dynamicScoreInput" class="mb-6 bg-gray-50 p-4 rounded-xl border border-gray-200">
            <p class="text-center text-gray-400 italic text-sm">Silakan pilih jadwal terlebih dahulu...</p>
        </div>

        <button onclick="addMatch()" class="w-full gold-gradient text-white px-4 py-3 rounded-xl hover:opacity-90 font-semibold shadow-md transform active:scale-95 transition"> ğŸ’¾ Simpan Hasil Match </button>
      </div>
    </div>

    <div id="statistikView" class="view-content hidden">
      <div class="relative rounded-2xl overflow-hidden mb-8 shadow-xl bg-slate-900 text-white min-h-[200px] flex items-center">
          <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=2000')] bg-cover bg-center opacity-40"></div>
          <div class="absolute inset-0 bg-gradient-to-r from-slate-900 via-slate-900/80 to-transparent"></div>
          <div class="relative p-8 z-10 max-w-2xl">
              <span class="text-amber-400 font-bold tracking-widest text-xs uppercase mb-2 block">Performance Center</span>
              <h2 class="text-3xl md:text-4xl font-head font-bold leading-tight mb-4">Statistik & <br>Klasemen Pemain</h2>
              <p class="text-gray-300 text-sm mb-6">Data akurat untuk evaluasi objektif. Teruslah berlatih, angka tidak pernah berbohong.</p>
              <button onclick="document.getElementById('statsInputSection').scrollIntoView({behavior: 'smooth'})" class="admin-only bg-amber-500 hover:bg-amber-600 text-slate-900 px-6 py-2 rounded-full font-bold text-sm transition shadow-lg">Input Statistik</button>
          </div>
      </div>

      <div id="statsPodium" class="mb-10 grid grid-cols-1 md:grid-cols-3 gap-4 items-end min-h-[100px]">
          </div>

      <div class="glass-effect rounded-2xl overflow-hidden shadow-lg mb-8 border border-gray-100">
          <div class="p-4 bg-gradient-to-r from-slate-50 to-white border-b border-gray-200 flex justify-between items-center">
              <h3 class="font-bold text-slate-700 flex items-center gap-2">ğŸ“Š Peringkat Keseluruhan</h3>
              <div class="text-[10px] text-gray-400 uppercase tracking-wider font-semibold bg-gray-100 px-2 py-1 rounded">Season 2024/2025</div>
          </div>
          <div class="overflow-x-auto">
              <table class="w-full text-sm text-left">
                  <thead class="text-xs text-gray-500 uppercase bg-gray-50/50 border-b border-gray-100">
                      <tr>
                          <th class="px-4 py-3 text-center w-12">Rank</th>
                          <th class="px-4 py-3">Pemain</th>
                          <th class="px-4 py-3 text-center w-16" title="Matches Played">Main</th>
                          <th class="px-4 py-3 text-center w-16 text-green-600" title="Gol (3 Poin)">âš½</th>
                          <th class="px-4 py-3 text-center w-16 text-blue-600" title="Assist (1 Poin)">ğŸ¯</th>
                          <th class="px-4 py-3 text-center w-16 text-orange-600" title="Saves (1 Poin)">ğŸ§¤</th>
                          <th class="px-4 py-3 text-center w-20 text-amber-600 font-extrabold text-base bg-amber-50" title="Total Poin">PTS</th>
                      </tr>
                  </thead>
                  <tbody id="statsList" class="divide-y divide-gray-100 bg-white">
                      </tbody>
              </table>
          </div>
      </div>

      <div id="statsInputSection" class="glass-effect rounded-xl p-6 mb-6 admin-only border border-amber-200 shadow-xl">
       <h2 class="text-xl font-bold text-amber-600 mb-4 flex items-center gap-2">ğŸ“ Input Statistik Baru</h2>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><select id="statsPlayerName" class="px-4 py-3 border border-amber-300 rounded-xl bg-white font-bold text-gray-700 focus:ring-2 focus:ring-amber-400"> <option value="">-- Pilih Pemain --</option> </select> <input type="date" id="statsDate" class="px-4 py-3 border border-amber-300 rounded-xl focus:ring-2 focus:ring-amber-400"></div>
       <div class="grid grid-cols-3 gap-3 mb-4">
           <div class="bg-green-50 p-2 rounded-lg border border-green-100"><label class="text-[10px] font-bold text-green-700 block mb-1">GOL (+3)</label> <input type="number" id="statsGoals" placeholder="0" min="0" class="w-full px-3 py-2 border border-green-200 rounded-lg text-center font-bold text-lg"></div>
           <div class="bg-blue-50 p-2 rounded-lg border border-blue-100"><label class="text-[10px] font-bold text-blue-700 block mb-1">ASSIST (+1)</label> <input type="number" id="statsAssists" placeholder="0" min="0" class="w-full px-3 py-2 border border-blue-200 rounded-lg text-center font-bold text-lg"></div>
           <div class="bg-orange-50 p-2 rounded-lg border border-orange-100"><label class="text-[10px] font-bold text-orange-700 block mb-1">SAVE (+1)</label> <input type="number" id="statsSaves" placeholder="0" min="0" class="w-full px-3 py-2 border border-orange-200 rounded-lg text-center font-bold text-lg"></div>
       </div>
       <div class="mb-4 bg-gray-50 p-4 rounded-xl border border-gray-200"><p class="text-xs font-bold text-gray-600 mb-2 uppercase tracking-wide">Bonus Poin:</p><div class="grid grid-cols-2 gap-3"><label class="flex items-center space-x-2 cursor-pointer bg-white p-2 rounded border hover:bg-gray-50"> <input type="checkbox" id="statsJersey" class="w-4 h-4 text-amber-600 rounded"> <span class="text-sm text-gray-700">ğŸ‘• Jersey (+2)</span> </label> <label class="flex items-center space-x-2 cursor-pointer bg-white p-2 rounded border hover:bg-gray-50"> <input type="checkbox" id="statsCleanSheet" class="w-4 h-4 text-amber-600 rounded"> <span class="text-sm text-gray-700">ğŸ§¤ Clean Sheet (+3)</span> </label></div></div>
       
       <div class="mb-6 bg-gradient-to-r from-amber-50 to-yellow-50 p-4 rounded-xl border border-amber-200"><p class="text-xs font-bold text-amber-800 mb-2 uppercase tracking-wide">Awards (MVP):</p><div class="grid grid-cols-2 gap-3 text-sm">
           <label class="flex items-center space-x-2 bg-white p-2 rounded border border-amber-100"><input type="checkbox" id="statsPOTM" class="w-4 h-4 text-amber-500"> <span>ğŸ… MOTM (+3)</span></label> 
           <label class="flex items-center space-x-2 bg-white p-2 rounded border border-amber-100"><input type="checkbox" id="statsBestXI" class="w-4 h-4 text-amber-500"> <span>ğŸ›¡ï¸ Best XI (+3)</span></label> 
       </div></div>
       <button onclick="addStats()" class="w-full gold-gradient text-white px-4 py-3 rounded-xl hover:opacity-90 font-bold shadow-lg transform active:scale-95 transition flex items-center justify-center gap-2"> ğŸ’¾ Simpan Data Statistik </button>
      </div>
    </div>

    <div id="inventarisView" class="view-content hidden">
      <div class="relative rounded-2xl overflow-hidden mb-8 shadow-xl bg-slate-800 text-white min-h-[180px] flex items-center">
          <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1522778119026-d647f0565c6d?q=80&w=2000')] bg-cover bg-center opacity-40"></div>
          <div class="absolute inset-0 bg-gradient-to-r from-slate-900 via-slate-900/80 to-transparent"></div>
          <div class="relative p-8 z-10 max-w-2xl">
              <span class="text-amber-400 font-bold tracking-widest text-xs uppercase mb-2 block">Gudang & Logistik</span>
              <h2 class="text-3xl md:text-4xl font-head font-bold leading-tight mb-2">Manajemen Aset Tim</h2>
              <p class="text-gray-300 text-sm mb-4">Pastikan perlengkapan tempur selalu siap sedia.</p>
              <button onclick="document.getElementById('inventorySectionAdmin').scrollIntoView({behavior: 'smooth'})" class="admin-only bg-amber-500 hover:bg-amber-600 text-slate-900 px-5 py-2 rounded-full font-bold text-xs transition shadow-lg">Tambah Aset</button>
          </div>
      </div>
      <div class="mb-8"><div id="inventoryList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div></div>
      <div id="inventorySectionAdmin" class="glass-effect rounded-xl p-6 mb-6 admin-only border border-amber-200">
       <h2 class="text-xl font-bold text-amber-600 mb-4 flex items-center gap-2">ğŸ“¦ Catat Aset Baru</h2>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><input type="text" id="itemName" placeholder="Nama Barang (Misal: Bola Adidas)" class="px-4 py-2 border border-amber-300 rounded-lg"> <input type="text" id="itemImage" placeholder="URL Foto Barang (https://...)" class="px-4 py-2 border border-amber-300 rounded-lg"></div>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><input type="number" id="itemQuantity" placeholder="Jumlah Stok" min="0" class="px-4 py-2 border border-amber-300 rounded-lg"> <select id="itemCondition" class="w-full px-4 py-2 border border-amber-300 rounded-lg bg-amber-50 font-semibold"> <option value="">-- Kondisi Fisik --</option> <option value="Baik">âœ… Baik (Layak Pakai)</option> <option value="Cukup">âš ï¸ Cukup (Ada Lecet)</option> <option value="Perlu Diganti">âŒ Rusak / Perlu Ganti</option> </select></div><button onclick="addInventory()" class="w-full gold-gradient text-white px-4 py-3 rounded-lg hover:opacity-90 font-semibold shadow-md"> â• Simpan ke Inventaris </button>
      </div>
    </div>

    <div id="sponsorView" class="view-content hidden">
      <div class="relative rounded-2xl overflow-hidden mb-8 shadow-xl bg-slate-900 text-white min-h-[200px] flex items-center">
          <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1517466787929-bc90951d0974?q=80&w=2000')] bg-cover bg-center opacity-40"></div>
          <div class="absolute inset-0 bg-gradient-to-r from-slate-900 via-slate-900/80 to-transparent"></div>
          <div class="relative p-8 z-10 max-w-2xl">
              <span class="text-amber-400 font-bold tracking-widest text-xs uppercase mb-2 block">Mitra & Pendukung</span>
              <h2 class="text-3xl md:text-4xl font-head font-bold leading-tight mb-4">Sempurnakan Do'a <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-yellow-200">Maksimalkan Ikhtiar</span></h2>
              <p class="text-gray-300 text-sm mb-6">Terima kasih kepada para donatur dan sponsor yang telah mendukung operasional Muslim Footballers Bandung.</p>
              <button onclick="handleManageSponsor()" class="bg-amber-500 hover:bg-amber-600 text-slate-900 px-6 py-2 rounded-full font-bold text-sm transition shadow-lg transform hover:scale-105">Kelola Sponsor</button>
          </div>
      </div>
      <div class="mb-8"><h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2 border-l-4 border-amber-500 pl-3"><span>ğŸ†</span> Wall of Fame</h3><div id="sponsorListGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div></div>
      <div id="sponsorSectionAdmin" class="glass-effect rounded-xl p-6 mb-6 admin-only border border-amber-200">
       <h2 class="text-xl font-bold text-amber-600 mb-4">ğŸ¤ Tambah Sponsor/Donatur Baru</h2>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><input type="text" id="sponsorName" placeholder="Nama Sponsor / Donatur" class="px-4 py-2 border border-amber-300 rounded-lg"> <input type="text" id="sponsorImage" placeholder="Link Logo (https://...)" class="px-4 py-2 border border-amber-300 rounded-lg"></div>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><input type="text" id="sponsorContact" placeholder="Kontak / Keterangan" class="px-4 py-2 border border-amber-300 rounded-lg"> <div class="flex gap-2"><input type="number" id="sponsorAmount" placeholder="Jumlah Donasi (Rp)" min="0" class="w-full px-4 py-2 border border-amber-300 rounded-lg"><select id="sponsorTier" class="w-full px-4 py-2 border border-amber-300 rounded-lg bg-amber-50 font-semibold"><option value="3">Tier 3 (Silver)</option><option value="2">Tier 2 (Gold)</option><option value="1">Tier 1 (Platinum)</option></select></div></div><button onclick="addSponsor()" class="w-full gold-gradient text-white px-4 py-3 rounded-lg hover:opacity-90 font-semibold shadow-md"> â• Tambah ke Database </button>
      </div>
    </div>
    
    <div id="galeriView" class="view-content hidden">
        <div class="relative rounded-2xl overflow-hidden mb-8 shadow-xl bg-slate-900 text-white min-h-[200px] flex items-center">
            <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1516733968668-dbdce39c4651?q=80&w=2000')] bg-cover bg-center opacity-40"></div>
            <div class="absolute inset-0 bg-gradient-to-r from-slate-900 via-slate-900/80 to-transparent"></div>
            <div class="relative p-8 z-10 max-w-2xl">
                <span class="text-amber-400 font-bold tracking-widest text-xs uppercase mb-2 block">Hall of Fame</span>
                <h2 class="text-4xl md:text-5xl font-head font-bold leading-tight mb-4">Galeri Tim</h2>
                <p class="text-gray-300 text-sm mb-6">Merekam jejak, mengabadikan momen, dan merayakan sejarah perjalanan kita.</p>
                <button onclick="document.getElementById('gallerySectionAdmin').scrollIntoView({behavior: 'smooth'})" class="admin-only bg-amber-500 hover:bg-amber-600 text-slate-900 px-6 py-2 rounded-full font-bold text-sm transition shadow-lg">Upload Foto</button>
            </div>
        </div>
        <div class="flex gap-2 mb-6 overflow-x-auto pb-2 scrollbar-hide">
            <button onclick="filterGallery('all')" id="btn-filter-all" class="px-5 py-2 rounded-full font-bold text-sm shadow-sm transition-all bg-slate-800 text-white border border-slate-700 gallery-filter">Semua</button>
            <button onclick="filterGallery('match')" id="btn-filter-match" class="px-5 py-2 rounded-full font-bold text-sm shadow-sm transition-all bg-white text-gray-600 border border-gray-200 hover:bg-gray-50 gallery-filter">ğŸ“¸ Match</button>
            <button onclick="filterGallery('jersey')" id="btn-filter-jersey" class="px-5 py-2 rounded-full font-bold text-sm shadow-sm transition-all bg-white text-gray-600 border border-gray-200 hover:bg-gray-50 gallery-filter">ğŸ‘• Jersey</button>
            <button onclick="filterGallery('venue')" id="btn-filter-venue" class="px-5 py-2 rounded-full font-bold text-sm shadow-sm transition-all bg-white text-gray-600 border border-gray-200 hover:bg-gray-50 gallery-filter">ğŸŸï¸ Venue</button>
        </div>
        <div id="galleryGrid" class="columns-1 md:columns-2 lg:columns-3 gap-4 space-y-4 mb-10"></div>
        <div id="gallerySectionAdmin" class="glass-effect rounded-xl p-6 mb-6 admin-only border border-amber-200">
            <h2 class="text-xl font-bold text-amber-600 mb-4 flex items-center gap-2">ğŸ“· Upload Galeri Baru</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><input type="text" id="galleryTitle" placeholder="Judul Foto (Misal: Final Match vs Tim X)" class="px-4 py-2 border border-amber-300 rounded-lg"><select id="galleryCategory" class="px-4 py-2 border border-amber-300 rounded-lg bg-white"><option value="match">ğŸ“¸ Momen Match</option><option value="jersey">ğŸ‘• Koleksi Jersey</option><option value="venue">ğŸŸï¸ Venue / Lapangan</option><option value="other">ğŸ—ï¸ Lainnya</option></select></div>
            <div class="grid grid-cols-1 gap-4 mb-4"><input type="text" id="galleryImage" placeholder="URL Foto (https://...)" class="px-4 py-2 border border-amber-300 rounded-lg"><textarea id="galleryDesc" placeholder="Deskripsi singkat..." class="px-4 py-2 border border-amber-300 rounded-lg h-20"></textarea></div><button onclick="addGalleryItem()" class="w-full gold-gradient text-white px-4 py-3 rounded-lg hover:opacity-90 font-semibold shadow-md"> ğŸ“¤ Upload ke Galeri </button>
        </div>
    </div>
   </main>
  </div>

  <div id="adminBtn" class="admin-toggle" onclick="toggleAdmin()">ğŸ”’</div>

  <div id="loginModal" class="hidden fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm"><div class="bg-white p-6 rounded-xl shadow-2xl w-80 text-center border-2 border-amber-400"><h3 class="text-xl font-bold text-amber-600 mb-4 font-arabic">ğŸ”‘ Login Admin</h3><input type="password" id="adminPassInput" placeholder="Masukkan Password..." class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:border-amber-500"><div class="flex gap-2"><button onclick="submitLogin()" class="flex-1 bg-amber-500 text-white py-2 rounded-lg hover:bg-amber-600 font-bold">Masuk</button> <button onclick="closeAdminModal()" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300">Batal</button></div></div></div>
  <div id="editInventoryModal" class="hidden fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm"><div class="bg-white p-6 rounded-xl shadow-2xl w-96 border-2 border-blue-400"><h3 class="text-xl font-bold text-blue-600 mb-4">âœï¸ Edit Inventaris</h3><div class="space-y-3"><input type="text" id="editItemName" placeholder="Nama Item" class="w-full px-4 py-2 border border-gray-300 rounded-lg"> <input type="text" id="editItemImage" placeholder="Link Foto (opsional)" class="w-full px-4 py-2 border border-gray-300 rounded-lg"> <input type="number" id="editItemQuantity" placeholder="Jumlah" class="w-full px-4 py-2 border border-gray-300 rounded-lg"> <select id="editItemCondition" class="w-full px-4 py-2 border border-gray-300 rounded-lg"> <option value="Baik">Baik</option> <option value="Cukup">Cukup</option> <option value="Perlu Diganti">Perlu Diganti</option> </select></div><div class="flex gap-2 mt-4"><button onclick="saveEditInventory()" class="flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 font-bold">ğŸ’¾ Simpan</button> <button onclick="closeEditInventoryModal()" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300">Batal</button></div></div></div>
  <div id="editSponsorModal" class="hidden fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm"><div class="bg-white p-6 rounded-xl shadow-2xl w-96 border-2 border-pink-400"><h3 class="text-xl font-bold text-pink-600 mb-4">âœï¸ Edit Sponsor</h3><div class="space-y-3"><input type="text" id="editSponsorName" placeholder="Nama Sponsor" class="w-full px-4 py-2 border border-gray-300 rounded-lg"> <input type="text" id="editSponsorImage" placeholder="Link Logo (https://...)" class="w-full px-4 py-2 border border-gray-300 rounded-lg"> <input type="text" id="editSponsorContact" placeholder="Kontak" class="w-full px-4 py-2 border border-gray-300 rounded-lg"> <input type="number" id="editSponsorAmount" placeholder="Jumlah Donasi (Rp)" class="w-full px-4 py-2 border border-gray-300 rounded-lg"><select id="editSponsorTier" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"><option value="3">Tier 3 (Silver)</option><option value="2">Tier 2 (Gold)</option><option value="1">Tier 1 (Platinum)</option></select></div><div class="flex gap-2 mt-4"><button onclick="saveEditSponsor()" class="flex-1 bg-pink-500 text-white py-2 rounded-lg hover:bg-pink-600 font-bold">ğŸ’¾ Simpan</button> <button onclick="closeEditSponsorModal()" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300">Batal</button></div></div></div>
  <div id="playerModal" class="hidden fixed inset-0 z-[9000] flex items-center justify-center bg-black/70 backdrop-blur-sm p-4"><div class="glass-effect w-full max-w-lg rounded-2xl overflow-hidden shadow-2xl relative bg-white"><button onclick="closePlayerModal()" class="absolute top-4 right-4 text-gray-500 hover:text-red-500 z-10 text-xl">âœ–</button><div class="bg-gradient-to-r from-amber-400 to-yellow-300 p-6 text-center"><div class="w-20 h-20 bg-white rounded-full mx-auto flex items-center justify-center text-4xl shadow-lg border-4 border-white mb-3">ğŸ‘¤</div><h2 id="modalPlayerName" class="text-2xl font-bold text-amber-900 font-arabic">Nama Pemain</h2><p id="modalPlayerPos" class="text-amber-800 font-semibold">Posisi</p></div><div class="p-6"><div class="grid grid-cols-3 gap-2 text-center mb-6"><div class="p-2 bg-amber-50 rounded-lg"><div class="text-xs text-gray-500">Main</div><div id="modalStatsCaps" class="text-xl font-bold text-amber-600">0</div></div><div class="p-2 bg-green-50 rounded-lg"><div class="text-xs text-gray-500">Gol</div><div id="modalStatsGoals" class="text-xl font-bold text-green-600">0</div></div><div class="p-2 bg-blue-50 rounded-lg"><div class="text-xs text-gray-500">Assist</div><div id="modalStatsAssist" class="text-xl font-bold text-blue-600">0</div></div></div><h3 class="font-bold text-gray-700 mb-2 border-b pb-1">Riwayat Performa</h3><div id="modalHistoryList" class="max-h-48 overflow-y-auto space-y-2 text-sm"></div></div></div></div>
  <div id="editMemberModal" class="hidden fixed inset-0 z-[9500] flex items-center justify-center bg-black/70 backdrop-blur-sm p-4"><div class="bg-white w-full max-w-2xl rounded-2xl overflow-hidden shadow-2xl"><div class="bg-gradient-to-r from-blue-500 to-blue-400 p-4 text-center"><h3 class="text-xl font-bold text-white">âœï¸ Edit Data Anggota</h3></div><div class="p-6"><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><input type="text" id="editMemberName" placeholder="Nama Lengkap" class="px-4 py-2 border border-gray-300 rounded-lg"> <select id="editMemberPosition" class="px-4 py-2 border border-gray-300 rounded-lg"> <option value="">Pilih Posisi</option> <option value="Kiper">Kiper</option> <option value="Bek">Bek</option> <option value="Gelandang">Gelandang</option> <option value="Striker">Striker</option> </select></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><input type="tel" id="editMemberPhone" placeholder="No. Telepon" class="px-4 py-2 border border-gray-300 rounded-lg"> <select id="editMemberSkill" class="px-4 py-2 border border-gray-300 rounded-lg"> <option value="">Level Keahlian</option> <option value="Pemula">Pemula</option> <option value="Menengah">Menengah</option> <option value="Mahir">Mahir</option> </select></div><div class="mb-4"><input type="text" id="editMemberPhoto" placeholder="URL Foto (https://...)" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4"> <select id="editMemberAvailability" class="w-full px-4 py-2 border border-gray-300 rounded-lg"> <option value="">Ketersediaan</option> <option value="Weekday">Weekday</option> <option value="Weekend">Weekend</option> <option value="Fleksibel">Fleksibel</option> </select></div><div class="flex gap-3"><button onclick="saveEditMember()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 font-bold">ğŸ’¾ Simpan Perubahan</button> <button onclick="closeEditMemberModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 font-bold">âŒ Batal</button></div></div></div></div>
  <div id="prayerModal" class="hidden fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4"><div class="glass-effect w-full max-w-md rounded-2xl overflow-hidden shadow-2xl relative bg-white border-2 border-emerald-400 flex flex-col max-h-[90vh]"><div class="bg-gradient-to-r from-emerald-600 to-green-500 p-6 text-center flex-shrink-0"><div class="w-16 h-16 bg-white/20 rounded-full mx-auto flex items-center justify-center text-3xl shadow-inner backdrop-blur-sm mb-3">ğŸ¤²</div><h2 id="modalPrayerTitle" class="text-xl font-bold text-white font-head tracking-wide">Judul Doa</h2></div><div class="p-6 text-center space-y-4 bg-[url('https://www.transparenttextures.com/patterns/cream-paper.png')] overflow-y-auto flex-1"><p id="modalPrayerArabic" class="text-2xl font-arabic text-emerald-900 leading-loose dir-rtl"></p><div class="h-px bg-emerald-200 w-1/2 mx-auto"></div><p id="modalPrayerTrans" class="text-sm text-slate-600 italic leading-relaxed"></p></div><div class="p-4 bg-gray-50 border-t border-gray-200 flex-shrink-0"><button onclick="closePrayerModal()" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 rounded-xl transition-colors shadow-sm">Tutup Kartu Doa</button></div></div></div>

  <div id="matchRegModal" class="hidden fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
      <div class="bg-white w-full max-w-lg rounded-2xl overflow-hidden shadow-2xl flex flex-col h-[85vh] md:max-h-[600px]">
          
          <div class="bg-gradient-to-r from-amber-500 to-amber-600 p-4 flex justify-between items-center text-white flex-shrink-0">
              <h3 class="text-lg font-bold font-head tracking-wide">ğŸ“‹ Daftar Pemain</h3>
              <button onclick="closeMatchRegModal()" class="text-white hover:text-gray-200 text-xl font-bold">âœ•</button>
          </div>
          
          <div class="p-4 border-b bg-gray-50 flex-shrink-0">
              <h4 id="regMatchTitle" class="font-bold text-gray-800 text-center truncate">Match Title</h4>
              <div class="flex justify-center mt-2 gap-2">
                  <span id="regQuotaBadge" class="text-xs font-bold px-3 py-1 rounded-full bg-blue-100 text-blue-700 border border-blue-200">Kuota: 0 / 0</span>
              </div>
          </div>

          <div class="flex-1 overflow-y-auto custom-scrollbar">
              
              <div class="sticky top-0 bg-gray-100 px-4 py-2 text-xs font-bold text-gray-600 border-b z-10 shadow-sm">
                  SUDAH TERDAFTAR
              </div>
              <div id="regRegisteredList" class="p-2 space-y-1 bg-white border-b mb-2"></div>

              <div class="admin-only">
                  <div class="sticky top-0 bg-gray-100 px-4 py-2 flex justify-between items-center border-y z-10 shadow-sm mt-2">
                        <span class="text-xs font-bold text-gray-600">TAMBAH PEMAIN BARU</span>
                  </div>
                  
                  <div class="px-4 py-2 border-b bg-white sticky top-[33px] z-10">
                     <input type="text" id="regPlayerSearch" onkeyup="filterPlayerChecklist()" placeholder="Cari nama pemain..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-amber-500">
                  </div>
                  
                  <div id="regPlayerChecklist" class="p-4 space-y-2 bg-white pb-20">
                      </div>
              </div>

              <div class="p-4 text-center text-gray-400 text-xs italic admin-only:hidden">
                  Hubungi Baginda Raja (Admin) untuk mendaftar atau mengelola pemain.
              </div>
          </div>

          <div class="admin-only p-4 border-t bg-white shadow-[0_-5px_15px_rgba(0,0,0,0.05)] flex-shrink-0 z-20">
              <div class="flex flex-col gap-2">
                  <button onclick="addBulkRegistration()" class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-xl font-bold text-sm shadow-md transition transform active:scale-95 flex items-center justify-center gap-2">
                      <span>âœ…</span> Tambahkan Pemain
                  </button>
                  
                  <button onclick="openTeamGenerator()" class="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-xl font-bold text-sm shadow-md transition flex items-center justify-center gap-2">
                      <span>âš™ï¸</span> Generate Tim Otomatis
                  </button>
              </div>
          </div>
      </div>
  </div>

  <div id="teamGeneratorModal" class="hidden fixed inset-0 z-[9999] flex items-center justify-center bg-black/70 backdrop-blur-sm p-4">
    <div class="bg-white w-full max-w-6xl rounded-3xl overflow-hidden shadow-2xl flex flex-col max-h-[95vh] border-4 border-gray-100">
        <div class="bg-slate-900 p-6 flex justify-between items-center text-white border-b border-gray-800 flex-shrink-0">
            <div>
                <h3 class="text-2xl font-bold font-head tracking-wide text-white">AI COACH</h3>
                <p class="text-xs text-gray-400">Team Generator & Tactics Board</p>
            </div>
            <button onclick="closeTeamGeneratorModal()" class="text-gray-400 hover:text-white text-2xl font-bold transition">âœ•</button>
        </div>
        
        <div class="admin-only p-4 border-b bg-gray-50 flex flex-wrap gap-4 items-end flex-shrink-0 justify-between">
             <div class="flex gap-4 items-end flex-1">
                 <div class="min-w-[150px]">
                     <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Formasi Dasar</label>
                     <select id="genFormation" class="w-full border-2 border-gray-200 rounded-xl p-2.5 text-sm font-semibold text-gray-700 focus:border-purple-500 outline-none" onchange="renderGeneratedTeams(tempGeneratedTeams)">
                         <option value="4-3-3">4-3-3 (Attack)</option>
                         <option value="4-4-2">4-4-2 (Classic)</option>
                         <option value="4-2-3-1">4-2-3-1 (Balanced)</option>
                         <option value="3-5-2">3-5-2 (Possession)</option>
                         <option value="5-3-2">5-3-2 (Defensive)</option>
                     </select>
                 </div>
                 <button onclick="generateTeamsLogic()" class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white px-6 py-2.5 rounded-xl font-bold text-sm shadow-lg transform active:scale-95 transition">
                     ğŸ”€ Acak Tim
                 </button>
             </div>
             
             <div class="flex gap-2">
                 <button id="btnToggleEdit" onclick="toggleEditTeams()" class="bg-white border-2 border-gray-300 text-gray-600 hover:bg-gray-100 hover:text-gray-800 px-6 py-2.5 rounded-xl font-bold text-sm shadow-sm transition flex items-center gap-2">
                     âœï¸ Mode Edit
                 </button>
                 <button onclick="saveGeneratedTeams()" class="bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white px-6 py-2.5 rounded-xl font-bold text-sm shadow-lg transform active:scale-95 transition">
                     ğŸ’¾ Simpan
                 </button>
             </div>
        </div>

        <div id="genTeamContainer" class="flex-1 overflow-x-auto overflow-y-hidden p-6 bg-slate-100 flex flex-nowrap items-start gap-6 scrollbar-dark">
            </div>

        <div class="p-5 border-t bg-white flex justify-end gap-3 z-10 shadow-[0_-5px_20px_rgba(0,0,0,0.05)] flex-shrink-0">
             <button onclick="closeTeamGeneratorModal()" class="px-6 py-2.5 rounded-xl text-gray-600 font-bold hover:bg-gray-100 transition">Tutup</button>
             <button onclick="pushToMatchRecap()" class="admin-only bg-green-600 hover:bg-green-700 text-white px-6 py-2.5 rounded-xl font-bold shadow-lg transition">
                 ğŸš€ Kirim ke Match History
             </button>
        </div>
    </div>
  </div>

  <script type="module">
    // ... imports ...
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // ... existing firebase config ...
    // --- FIREBASE CONFIGURATION ---
    const myFirebaseConfig = {
      apiKey: "AIzaSyDXA6RxsaZN1wL-fUEsvipbBonUMZac4Y4",
      authDomain: "muslimfootballers-bandung.firebaseapp.com",
      projectId: "muslimfootballers-bandung",
      storageBucket: "muslimfootballers-bandung.firebasestorage.app",
      messagingSenderId: "546357578832",
      appId: "1:546357578832:web:87b8759b4c0fe9198dd555",
      measurementId: "G-6X09T9TVMJ"
    };

    let firebaseConfig;
    if (typeof __firebase_config !== 'undefined') {
        firebaseConfig = JSON.parse(__firebase_config);
    } else {
        firebaseConfig = myFirebaseConfig;
    }

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

    let currentUser = null;
    let allData = [];
    let currentMenu = 'dashboard';
    let currentEditingRecord = null;
    let countdownInterval = null;
    let searchQuery = ""; 
    let currentMatchIdForReg = null; 
    let currentGalleryFilter = 'all'; 
    let tempGeneratedTeams = [];
    let isEditingTeams = false; // New state for edit mode

    // ... initAuth & setupDataListener ...
    const initAuth = async () => {
        try {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        } catch (error) {
            console.error("Auth Error:", error);
        }
    };
    initAuth();

    onAuthStateChanged(auth, (user) => {
        currentUser = user;
        if (user) {
            setupDataListener(user);
        }
    });

    function setupDataListener(user) {
        const q = collection(db, 'artifacts', appId, 'public', 'data', 'universal_data');
        onSnapshot(q, (snapshot) => {
            allData = snapshot.docs.map(doc => ({
                ...doc.data(),
                __backendId: doc.id
            }));
            
            renderCurrentView();
            renderKajianList();
            renderPrayerSchedule();
            updateDashboard(); 
            if(currentMenu === 'statistik') updatePlayerDropdown();
            
            // --- UPDATE PENTING: ISI DROPDOWN JADWAL SAAT DATA MASUK ---
            populateScheduleDropdown(); 
            
            if(currentMatchIdForReg && !document.getElementById('matchRegModal').classList.contains('hidden')) {
                renderMatchRegModal(currentMatchIdForReg);
            }
        }, (error) => {
            console.error("Data fetch error:", error);
        });
    }

    // ... other window functions ...
    window.handleGlobalSearch = function() {
        const input = document.getElementById('globalSearchInput');
        searchQuery = input.value.toLowerCase();
        renderCurrentView();
    }

    function renderCurrentView() {
        if(currentMenu === 'dashboard') updateDashboard();
        else if(currentMenu === 'anggota') renderMembers();
        else if(currentMenu === 'inventaris') renderInventory();
        else if(currentMenu === 'sponsor') renderSponsors();
        else if(currentMenu === 'jadwal') renderSchedules();
        else if(currentMenu === 'match') renderMatches();
        else if(currentMenu === 'statistik') renderStats();
        else if(currentMenu === 'galeri') renderGallery(); 
    }

    // ... CRUD functions ...
    async function createData(data) {
        if (!currentUser) return;
        try {
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'universal_data'), data);
        } catch (e) {
            console.error(e);
            showToast("Gagal menyimpan (Cek Console)", "error");
        }
    }

    async function updateData(data) {
        if (!currentUser) return;
        try {
            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'universal_data', data.__backendId);
            const { __backendId, ...updatePayload } = data;
            await updateDoc(docRef, updatePayload);
        } catch (e) {
            console.error(e);
            showToast("Gagal update", "error");
        }
    }
    
    async function updateDocWrapper(id, data) {
        if (!currentUser) return;
        try {
            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'universal_data', id);
            await updateDoc(docRef, data);
        } catch(e) { console.error(e); showToast("Gagal update doc", "error"); }
    }

    async function deleteData(id) {
        if (!currentUser) return;
        try {
            await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'universal_data', id));
            showToast("Data dihapus");
        } catch (e) {
            console.error(e);
            showToast("Gagal menghapus", "error");
        }
    }

    const hadistDatabase = [ 
        "Mukmin yang kuat lebih baik dan lebih dicintai Allah daripada mukmin yang lemah. (HR. Muslim)",
        "Sebaik-baik manusia adalah yang paling bermanfaat bagi manusia lainnya. (HR. Ahmad)",
        "Barangsiapa menempuh jalan untuk menuntut ilmu, Allah mudahkan baginya jalan menuju surga. (HR. Muslim)",
        "Senyummu di hadapan saudaramu adalah sedekah bagimu. (HR. Tirmidzi)"
    ];

    // ... App Logic ...
    function initializeAppUI() {
      updateDates(); 
      setInterval(updateDates, 60000); 
      displayRenungan(); 
      renderPrayerSchedule();
      getOnlineDoa(); 
      showMenu('dashboard');
      
      document.querySelectorAll('.menu-item').forEach(card => card.addEventListener('click', () => {
        showMenu(card.dataset.menu);
        if(card.dataset.menu === 'islami') getOnlineDoa(); 
      }));
      
      localStorage.removeItem('isAdmin'); 
      if(document.body.classList.contains('is-admin')) {
          document.body.classList.remove('is-admin');
          document.getElementById('adminBtn').textContent='ğŸ”’';
      }
    }

    function updateDates() { 
        const now = new Date(); 
        document.getElementById('currentDate').textContent = now.toLocaleDateString('id-ID', { weekday:'long', year:'numeric', month:'long', day:'numeric' }); 
        document.getElementById('hijriDate').textContent = '1446 H';
        const hijriEl = document.getElementById('hijriDateDisplay');
        if(hijriEl) hijriEl.textContent = '1446 H'; 
    }
    
    window.showMenu = function(menu) { 
        currentMenu = menu; 
        searchQuery = "";
        const searchInput = document.getElementById('globalSearchInput');
        if(searchInput) searchInput.value = "";

        document.querySelectorAll('.menu-item').forEach(c => c.classList.remove('active')); 
        const activeItem = document.querySelector(`[data-menu="${menu}"]`);
        if(activeItem) activeItem.classList.add('active'); 
        
        document.querySelectorAll('.view-content').forEach(v => v.classList.add('hidden')); 
        const view = document.getElementById(menu + 'View');
        if(view) view.classList.remove('hidden'); 
        
        renderCurrentView(); 
        if(menu === 'statistik') updatePlayerDropdown(); 
    }
    
    // ... render functions ...
    function updateDashboard() {
        const members = allData.filter(d=>d.type==='member'); 
        const matches = allData.filter(d=>d.type==='match');
        if(document.getElementById('totalAnggota')) document.getElementById('totalAnggota').textContent = members.length;
        if(document.getElementById('totalMatches')) document.getElementById('totalMatches').textContent = matches.length;
        
        const stats = allData.filter(d=>d.type==='stats');
        const goals = {}; const assists = {};
        stats.forEach(s=>{ 
            if(!goals[s.member_id]) goals[s.member_id]={name:'', val:0}; goals[s.member_id].val+=(parseInt(s.goals)||0);
            if(!assists[s.member_id]) assists[s.member_id]={name:'', val:0}; assists[s.member_id].val+=(parseInt(s.assists)||0);
            const m = members.find(x=>x.__backendId===s.member_id); if(m) { goals[s.member_id].name=m.name; assists[s.member_id].name=m.name; }
        });
        
        const topG = Object.values(goals).sort((a,b)=>b.val-a.val)[0]; 
        if(topG) {
            if(document.getElementById('topScorer')) document.getElementById('topScorer').textContent = topG.name; 
            if(document.getElementById('topScorerGoals')) document.getElementById('topScorerGoals').textContent = topG.val+' Goals';
            const initials = topG.name.split(' ').map(n=>n[0]).join('').substring(0,2);
            if(document.getElementById('topScorerAvatar')) document.getElementById('topScorerAvatar').innerText = initials;
        }

        const topA = Object.values(assists).sort((a,b)=>b.val-a.val)[0]; 
        if(topA) {
            if(document.getElementById('topAssist')) document.getElementById('topAssist').textContent = topA.name; 
            if(document.getElementById('topAssistCount')) document.getElementById('topAssistCount').textContent = topA.val+' Assists';
            const initials = topA.name.split(' ').map(n=>n[0]).join('').substring(0,2);
            if(document.getElementById('topAssistAvatar')) document.getElementById('topAssistAvatar').innerText = initials;
        }

        const upcomingSchedules = allData.filter(d => d.type === 'schedule' && new Date(d.date + 'T' + (d.time || '00:00')) > new Date())
                                         .sort((a,b) => new Date(a.date) - new Date(b.date));
        
        if (upcomingSchedules.length > 0) {
            const next = upcomingSchedules[0];
            if(document.getElementById('nextMatchTitle')) document.getElementById('nextMatchTitle').textContent = "vs " + next.name;
            const d = new Date(next.date);
            if(document.getElementById('nextMatchDate')) document.getElementById('nextMatchDate').textContent = d.toLocaleDateString('id-ID', {day:'numeric', month:'long'}) + ' @ ' + next.time;
            
            if(countdownInterval) clearInterval(countdownInterval);
            const target = new Date(next.date + 'T' + (next.time || '00:00')).getTime();
            
            // Logika hitung mundur sampai detik untuk Baginda Raja
            countdownInterval = setInterval(() => {
                const now = new Date().getTime();
                const distance = target - now;
                
                if (distance < 0) {
                    clearInterval(countdownInterval);
                    ['Days', 'Hours', 'Minutes', 'Seconds'].forEach(id => {
                        const el = document.getElementById('countdown' + id);
                        if(el) el.textContent = "00";
                    });
                } else {
                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                    if(document.getElementById('countdownDays')) 
                        document.getElementById('countdownDays').textContent = String(days).padStart(2, '0');
                    if(document.getElementById('countdownHours')) 
                        document.getElementById('countdownHours').textContent = String(hours).padStart(2, '0');
                    if(document.getElementById('countdownMinutes')) 
                        document.getElementById('countdownMinutes').textContent = String(minutes).padStart(2, '0');
                    if(document.getElementById('countdownSeconds')) 
                        document.getElementById('countdownSeconds').textContent = String(seconds).padStart(2, '0');
                }
            }, 1000);
        } else {
            if(document.getElementById('nextMatchTitle')) document.getElementById('nextMatchTitle').textContent = "Belum Ada Jadwal";
            if(document.getElementById('nextMatchDate')) document.getElementById('nextMatchDate').textContent = "-";
        }
    }

    async function getAutoPrayerTimes() {
      const date = new Date(); const d = String(date.getDate()).padStart(2,'0'); const m = String(date.getMonth()+1).padStart(2,'0'); const y = date.getFullYear();
      try { const res = await fetch(`https://api.aladhan.com/v1/timings/${d}-${m}-${y}?latitude=-6.9175&longitude=107.6191&method=20`); const json = await res.json(); const t = json.data.timings; return [{prayer:"Subuh",prayer_time:t.Fajr},{prayer:"Dzuhur",prayer_time:t.Dhuhr},{prayer:"Ashar",prayer_time:t.Asr},{prayer:"Maghrib",prayer_time:t.Maghrib},{prayer:"Isya",prayer_time:t.Isha}]; } catch(e){ return null; }
    }
    
    async function renderPrayerSchedule() {
      const container = document.getElementById('prayerSchedule');
      if(!container) return;
      container.innerHTML = '<p class="col-span-full text-center text-emerald-600 animate-pulse">Mengambil jadwal sholat...</p>';
      const data = await getAutoPrayerTimes() || [{prayer:"Subuh",prayer_time:"04:15"},{prayer:"Dzuhur",prayer_time:"11:50"},{prayer:"Ashar",prayer_time:"15:15"},{prayer:"Maghrib",prayer_time:"18:00"},{prayer:"Isya",prayer_time:"19:15"}];
      container.innerHTML = data.map((p, idx) => `<div class="bg-white rounded-xl p-3 border border-emerald-100 shadow-sm text-center hover:shadow-md transition-all group"><div class="text-xs text-gray-400 uppercase tracking-wider mb-1 font-semibold">${p.prayer}</div><div class="text-lg font-bold text-emerald-800 font-head group-hover:scale-110 transition-transform">${p.prayer_time}</div></div>`).join('');
    }
    
    async function getRandomAyat() {
        const totalAyat = 6236;
        const randomNum = Math.floor(Math.random() * totalAyat) + 1;
        const ayatEl = document.getElementById('ayatText');
        const transEl = document.getElementById('ayatTranslation');
        if(ayatEl) ayatEl.innerHTML = '<span class="text-base text-gray-400 animate-pulse">Sedang mengambil ayat acak...</span>';
        try {
            const response = await fetch(`https://api.alquran.cloud/v1/ayah/${randomNum}/editions/quran-uthmani,id.indonesian`);
            const data = await response.json();
            if (data.code === 200 && ayatEl && transEl) {
                const arabicData = data.data[0]; const indoData = data.data[1];
                ayatEl.innerText = arabicData.text;
                transEl.innerHTML = `"${indoData.text}" <br><br><b>(QS. ${arabicData.surah.englishName}: ${arabicData.numberInSurah})</b>`;
            }
        } catch (error) { if(ayatEl) ayatEl.innerText = "Fainna ma'al 'usri yusra"; if(transEl) transEl.innerText = "Sesungguhnya bersama kesulitan ada kemudahan."; }
    }

    window.getOnlineDoa = async function() {
        const container = document.getElementById('doaListContainer');
        if(!container) return;
        container.innerHTML = '<div class="text-center py-4 text-gray-500 text-sm animate-pulse">Mengambil data doa online...</div>';
        try {
            const response = await fetch('https://open-api.my.id/api/doa');
            const data = await response.json();
            if(Array.isArray(data) && data.length > 0) {
                const shuffled = data.sort(() => 0.5 - Math.random());
                const selected = shuffled.slice(0, 5); 
                container.innerHTML = selected.map(d => {
                    const safeJudul = d.judul.replace(/'/g, "\\'");
                    const safeArab = d.arab.replace(/'/g, "\\'");
                    const safeTerjemah = d.terjemah.replace(/'/g, "\\'");
                    return `<div class="p-3 bg-white border border-green-100 rounded-lg hover:shadow-md transition cursor-pointer group" onclick="showPrayer('${safeJudul}', '${safeArab}', '${safeTerjemah}')"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center text-xs group-hover:bg-emerald-600 group-hover:text-white transition">ğŸ¤²</div><div class="text-sm font-semibold text-gray-700 truncate">${d.judul}</div></div></div>`;
                }).join('');
            } else { throw new Error("Data kosong"); }
        } catch (e) { container.innerHTML = '<div class="text-center py-2 text-red-400 text-xs">Gagal memuat doa online.</div>'; }
    }

    function displayRenungan() { refreshRenungan(); }
    window.refreshRenungan = function() { 
        const randomH = hadistDatabase[Math.floor(Math.random() * hadistDatabase.length)];
        const hEl = document.getElementById('hadistText');
        if(hEl) hEl.textContent = randomH;
        getRandomAyat();
    }
    window.showPrayer = function(title, arabic, translation) {
        document.getElementById('modalPrayerTitle').textContent = title;
        document.getElementById('modalPrayerArabic').textContent = arabic;
        document.getElementById('modalPrayerTrans').textContent = translation;
        document.getElementById('prayerModal').classList.remove('hidden');
    }
    window.closePrayerModal = function() { document.getElementById('prayerModal').classList.add('hidden'); }
    
    window.addKajian = async function() { await createData({ type:'kajian', kajian_topic:document.getElementById('kajianTopic').value, kajian_date:document.getElementById('kajianDate').value, kajian_time:document.getElementById('kajianTime').value, kajian_speaker:document.getElementById('kajianSpeaker').value, createdAt: new Date().toISOString() }); showToast('Jadwal Kajian Disimpan'); }
    function renderKajianList() { 
        const listContainer = document.getElementById('kajianList');
        if (!listContainer) return;
        const items = allData.filter(d=>d.type==='kajian').sort((a,b)=>new Date(a.kajian_date)-new Date(b.kajian_date));
        if(items.length === 0) { listContainer.innerHTML = `<div class="p-6 text-center text-gray-400 italic bg-gray-50 rounded-xl border border-dashed border-gray-300">Belum ada agenda kajian dalam waktu dekat.</div>`; return; }
        listContainer.innerHTML = items.map(k=>`<div class="bg-white rounded-xl shadow-sm border border-l-4 border-l-amber-400 p-4 flex flex-col md:flex-row justify-between items-start md:items-center hover-lift relative overflow-hidden"><div class="flex-1"><div class="flex items-center gap-2 mb-1"><span class="bg-green-100 text-green-700 text-[10px] font-bold px-2 py-0.5 rounded uppercase">Kajian Rutin</span><span class="text-xs text-gray-400 flex items-center gap-1">ğŸ“… ${new Date(k.kajian_date).toLocaleDateString('id-ID', {day:'numeric', month:'long'})} â€¢ â° ${k.kajian_time}</span></div><h4 class="text-lg font-bold text-slate-800">${k.kajian_topic}</h4><p class="text-sm text-gray-600 mt-1">ğŸ‘¤ Bersama: <span class="font-semibold text-amber-700">${k.kajian_speaker}</span></p></div><button onclick="deleteKajian('${k.__backendId}')" class="admin-only absolute top-2 right-2 text-red-400 hover:text-red-600 bg-white p-1 rounded-full shadow-sm">ğŸ—‘ï¸</button></div>`).join(''); 
    }
    window.deleteKajian = async function(id) { if(confirm('Hapus?')) await deleteData(id); }

    window.addMember = async function() { 
        const name = document.getElementById('memberName').value; 
        if(!name) return; 
        await createData({ type:'member', name, position:document.getElementById('memberPosition').value, phone:document.getElementById('memberPhone').value, skill_level:document.getElementById('memberSkill').value, availability:document.getElementById('memberAvailability').value, photo: document.getElementById('memberPhoto').value, createdAt: new Date().toISOString() }); 
        document.getElementById('memberName').value=''; document.getElementById('memberPhoto').value=''; 
        showToast('Anggota ditambah'); 
    }
    
    function renderMembers() { 
        const container = document.getElementById('memberList');
        if (!container) return;
        const countEl = document.getElementById('totalPlayerCount');
        let members = allData.filter(d=>d.type==='member');
        if (searchQuery) members = members.filter(m => m.name.toLowerCase().includes(searchQuery) || m.position.toLowerCase().includes(searchQuery));
        if(countEl) countEl.innerText = `${members.length} Pemain Terdaftar`;
        if (members.length === 0) { container.innerHTML = `<div class="col-span-full text-center py-12 text-gray-400">Tidak ada pemain ditemukan.</div>`; return; }
        container.innerHTML = members.map(m => {
            let posGradient = "from-gray-700 to-gray-900";
            if (m.position === 'Kiper') posGradient = "from-yellow-600 to-yellow-800";
            else if (m.position === 'Bek') posGradient = "from-blue-600 to-blue-800";
            else if (m.position === 'Gelandang') posGradient = "from-emerald-600 to-emerald-800";
            else if (m.position === 'Striker') posGradient = "from-rose-600 to-rose-800";
            let stars = m.skill_level === 'Mahir' ? "â­â­â­" : (m.skill_level === 'Menengah' ? "â­â­" : "â­");
            const pStats = allData.filter(d=>d.type==='stats' && d.member_id===m.__backendId);
            const caps = pStats.length;
            const goals = pStats.reduce((a,b)=>a+(parseInt(b.goals)||0),0);
            return `<div class="relative bg-gradient-to-b ${posGradient} rounded-2xl p-4 text-white shadow-xl hover-lift group overflow-hidden cursor-pointer border-2 border-white/20" onclick="showPlayerDetail('${m.__backendId}')"><div class="flex justify-between items-start mb-2 relative z-10"><div class="text-center"><div class="text-2xl font-bold font-head leading-none">${90 + (caps > 5 ? 5 : 0)}</div><div class="text-[10px] opacity-75 uppercase">OVR</div></div><div class="text-xs font-bold bg-white/20 backdrop-blur px-2 py-1 rounded uppercase">${m.position}</div></div><div class="w-24 h-24 mx-auto mb-2 relative z-10 rounded-full border-4 border-white/30 overflow-hidden bg-white/10 shadow-lg"><img src="${m.photo || 'https://via.placeholder.com/150?text=' + m.name.charAt(0)}" class="w-full h-full object-cover" onerror="this.src='https://via.placeholder.com/150?text=Player'"></div><div class="text-center relative z-10"><h3 class="font-bold font-head text-xl leading-tight truncate px-2">${m.name}</h3><div class="text-xs text-white/70 mb-3">${stars} â€¢ ${m.availability}</div><div class="grid grid-cols-3 gap-1 text-center bg-black/20 rounded-lg p-2 border border-white/10"><div><div class="font-bold text-sm">${caps}</div><div class="text-[9px] uppercase opacity-60">Main</div></div><div><div class="font-bold text-sm">${goals}</div><div class="text-[9px] uppercase opacity-60">Gol</div></div><div><div class="font-bold text-sm">Active</div><div class="text-[9px] uppercase opacity-60">Status</div></div></div></div><div class="admin-only absolute top-2 right-2 z-20 hidden group-hover:flex gap-1"><button onclick="event.stopPropagation();editMember('${m.__backendId}')" class="bg-white text-blue-600 p-1.5 rounded-full text-xs shadow hover:scale-110 transition">âœï¸</button><button onclick="event.stopPropagation();deleteMember('${m.__backendId}')" class="bg-white text-red-600 p-1.5 rounded-full text-xs shadow hover:scale-110 transition">ğŸ—‘ï¸</button></div></div>`;
        }).join('');
    }
    
    // ... editMember, saveEditMember, etc ...
    window.editMember = function(id) { currentEditingRecord=allData.find(d=>d.__backendId===id); if(!currentEditingRecord) return; document.getElementById('editMemberName').value=currentEditingRecord.name; document.getElementById('editMemberPosition').value=currentEditingRecord.position; document.getElementById('editMemberPhone').value=currentEditingRecord.phone; document.getElementById('editMemberSkill').value=currentEditingRecord.skill_level; document.getElementById('editMemberAvailability').value=currentEditingRecord.availability; document.getElementById('editMemberPhoto').value=currentEditingRecord.photo || ''; document.getElementById('editMemberModal').classList.remove('hidden'); }
    window.saveEditMember = async function() { if(!currentEditingRecord) return; await updateData({...currentEditingRecord, name:document.getElementById('editMemberName').value, position:document.getElementById('editMemberPosition').value, phone:document.getElementById('editMemberPhone').value, skill_level:document.getElementById('editMemberSkill').value, availability:document.getElementById('editMemberAvailability').value, photo: document.getElementById('editMemberPhoto').value }); showToast('Update berhasil'); closeEditMemberModal(); }
    window.closeEditMemberModal = function() { document.getElementById('editMemberModal').classList.add('hidden'); }
    window.deleteMember = async function(id) { if(confirm('Hapus?')) await deleteData(id); }
    window.showPlayerDetail = function(id) { document.getElementById('playerModal').classList.remove('hidden'); const m = allData.find(d=>d.__backendId===id); if(m) { document.getElementById('modalPlayerName').textContent=m.name; document.getElementById('modalPlayerPos').textContent=m.position; const pStats = allData.filter(d=>d.type==='stats' && d.member_id===id); const totalGoals = pStats.reduce((a,b)=>a+(parseInt(b.goals)||0),0); const totalAssists = pStats.reduce((a,b)=>a+(parseInt(b.assists)||0),0); document.getElementById('modalStatsCaps').textContent = pStats.length; document.getElementById('modalStatsGoals').textContent = totalGoals; document.getElementById('modalStatsAssist').textContent = totalAssists; document.getElementById('modalHistoryList').innerHTML = pStats.map(s => `<div class="flex justify-between border-b py-1"><span>${s.date}</span><span class="font-bold">${s.totalPoints} pts</span></div>`).join(''); } }
    window.closePlayerModal = function() { document.getElementById('playerModal').classList.add('hidden'); }

    window.exportMembersCSV = function() {
        const members = allData.filter(d => d.type === 'member');
        if (members.length === 0) { showToast('Data kosong', 'error'); return; }
        let csvContent = "data:text/csv;charset=utf-8,Nama,Posisi,NoHP,Skill,Ketersediaan\n"; 
        members.forEach(function(m) { const row = [`"${m.name}"`, m.position, `'${m.phone}`, m.skill_level, m.availability].join(","); csvContent += row + "\n"; });
        const encodedUri = encodeURI(csvContent); const link = document.createElement("a"); link.setAttribute("href", encodedUri); link.setAttribute("download", "Squad_Muslim_Footballers.csv"); document.body.appendChild(link); link.click(); document.body.removeChild(link);
    }

    window.processImport = function(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = async function(e) {
            const text = e.target.result;
            const rows = text.split("\n").slice(1);
            let count = 0;
            for (let row of rows) {
                if (!row.trim()) continue;
                const cols = row.split(","); 
                if (cols.length >= 2) {
                    const name = cols[0].replace(/"/g, "").trim();
                    if(!allData.find(d=>d.type==='member' && d.name===name)){
                        await createData({ type: 'member', name: name, position: cols[1].trim(), phone: cols[2] ? cols[2].replace(/'/g, "").trim() : "", skill_level: cols[3] ? cols[3].trim() : "Pemula", availability: cols[4] ? cols[4].trim() : "Fleksibel", photo: '', createdAt: new Date().toISOString() });
                        count++;
                    }
                }
            }
            showToast(`${count} data berhasil diimpor!`);
            event.target.value = '';
        };
        reader.readAsText(file);
    }
    
    window.addSchedule = async function() { await createData({ type:'schedule', schedule_type:document.getElementById('scheduleType').value, name:document.getElementById('scheduleName').value, date:document.getElementById('scheduleDate').value, time:document.getElementById('scheduleTime').value, location:document.getElementById('scheduleLocation').value, createdAt:new Date().toISOString() }); showToast('Jadwal disimpan'); }
   window.deleteSchedule = async function(id) {
    if(confirm('Apakah Baginda yakin ingin menghapus jadwal ini? Seluruh data pendaftaran pemain di jadwal ini juga akan ikut terhapus.')) {
        try {
            await deleteData(id);
            const pendaftaranTerkait = allData.filter(d => d.type === 'registration' && d.schedule_id === id);
            for (let reg of pendaftaranTerkait) {
                await deleteData(reg.__backendId);
            }
            showToast('Jadwal berhasil dimusnahkan!');
        } catch (error) {
            showToast('Gagal menghapus jadwal.', 'error');
        }
    }
}
// Fungsi hapus aset/inventaris
window.deleteInventory = async function(id) {
    if(confirm('Hapus aset ini dari gudang, Baginda?')) {
        await deleteData(id);
        showToast('Aset telah dimusnahkan!');
    }
}

// Fungsi hapus sponsor
window.deleteSponsor = async function(id) {
    if(confirm('Baginda yakin ingin mencopot sponsor ini dari Wall of Fame?')) {
        await deleteData(id);
        showToast('Sponsor telah dihapus.');
    }
}   
    // ... Match Reg Modal logic ...
    window.openMatchRegModal = function(scheduleId) {
        currentMatchIdForReg = scheduleId;
        renderMatchRegModal(scheduleId);
        document.getElementById('matchRegModal').classList.remove('hidden');
    }
    window.closeMatchRegModal = function() {
        document.getElementById('matchRegModal').classList.add('hidden');
        currentMatchIdForReg = null;
        tempGeneratedTeams = []; 
    }
    window.filterPlayerChecklist = function() {
        const input = document.getElementById('regPlayerSearch');
        const filter = input.value.toLowerCase();
        const checklist = document.getElementById('regPlayerChecklist');
        const items = checklist.getElementsByClassName('player-check-item');
        for (let i = 0; i < items.length; i++) {
            const name = items[i].getAttribute('data-name').toLowerCase();
            if (name.indexOf(filter) > -1) { items[i].style.display = "flex"; } else { items[i].style.display = "none"; }
        }
    }

    function renderMatchRegModal(scheduleId) {
        const schedule = allData.find(d => d.__backendId === scheduleId);
        if(!schedule) return;
        document.getElementById('regMatchTitle').textContent = schedule.name;
        const registrations = allData.filter(d => d.type === 'registration' && d.schedule_id === scheduleId);
        const playerCount = registrations.length;
        let maxQuota = schedule.schedule_type === 'Friendly Match' ? 22 : 44;
        const badgeColor = playerCount >= maxQuota ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700';
        document.getElementById('regQuotaBadge').innerHTML = `Kuota: ${playerCount} / ${maxQuota}`;
        document.getElementById('regQuotaBadge').className = `text-xs font-bold px-3 py-1 rounded-full border ${badgeColor}`;
        const regListContainer = document.getElementById('regRegisteredList');
        if (playerCount === 0) { regListContainer.innerHTML = '<div class="text-center text-gray-400 py-2 text-xs italic">Belum ada pemain terdaftar.</div>'; } else {
            regListContainer.innerHTML = registrations.map((r, i) => `<div class="flex justify-between items-center bg-gray-50 p-2 rounded border border-gray-100 mb-1"><div><span class="text-xs font-bold text-gray-700">${i+1}. ${r.member_name}</span><span class="text-[10px] text-gray-500 block">Posisi: ${r.position_played || '-'}</span></div><button onclick="deleteRegistration('${r.__backendId}')" class="admin-only text-red-500 hover:text-red-700 text-xs px-2">âœ•</button></div>`).join('');
        }
        const allMembers = allData.filter(d => d.type === 'member');
        const registeredIds = registrations.map(r => r.member_id);
        const availableMembers = allMembers.filter(m => !registeredIds.includes(m.__backendId));
        const checklistContainer = document.getElementById('regPlayerChecklist');
        if (playerCount >= maxQuota) {
            checklistContainer.innerHTML = '<div class="text-center text-red-500 py-4 font-bold">Kuota Penuh!</div>';
        } else {
            checklistContainer.innerHTML = availableMembers.map(m => `
                <div class="player-check-item flex items-center gap-3 p-2 hover:bg-gray-50 border-b border-gray-100" data-name="${m.name}">
                    <input type="checkbox" id="chk_${m.__backendId}" value="${m.__backendId}" class="player-checkbox w-4 h-4 text-amber-500 rounded focus:ring-amber-500">
                    <div class="flex-1">
                        <label for="chk_${m.__backendId}" class="text-sm font-semibold text-gray-700 cursor-pointer block">${m.name}</label>
                        <select id="pos_${m.__backendId}" class="text-[10px] border rounded bg-white px-1 py-0.5 mt-0.5 text-gray-500">
                            <option value="GK" ${m.position === 'Kiper' ? 'selected' : ''}>GK</option>
                            <option value="DEF" ${m.position === 'Bek' ? 'selected' : ''}>DEF</option>
                            <option value="MID" ${m.position === 'Gelandang' ? 'selected' : ''}>MID</option>
                            <option value="FWD" ${m.position === 'Striker' ? 'selected' : ''}>FWD</option>
                        </select>
                    </div>
                </div>
            `).join('');
        }
    }

    window.addBulkRegistration = async function() {
        if (!currentMatchIdForReg) return;
        const checkboxes = document.querySelectorAll('.player-checkbox:checked');
        if (checkboxes.length === 0) { showToast('Pilih minimal satu pemain', 'error'); return; }
        const schedule = allData.find(d => d.__backendId === currentMatchIdForReg);
        const currentRegs = allData.filter(d => d.type === 'registration' && d.schedule_id === currentMatchIdForReg).length;
        let maxQuota = schedule.schedule_type === 'Friendly Match' ? 22 : 44;
        if (currentRegs + checkboxes.length > maxQuota) { showToast(`Kuota tidak cukup! Sisa: ${maxQuota - currentRegs}`, 'error'); return; }
        let addedCount = 0;
        for (const chk of checkboxes) {
            const memberId = chk.value;
            const member = allData.find(d => d.__backendId === memberId);
            const posSelect = document.getElementById(`pos_${memberId}`);
            const positionPlayed = posSelect ? posSelect.value : member.position;
            if (member) { await createData({ type: 'registration', schedule_id: currentMatchIdForReg, member_id: memberId, member_name: member.name, position_played: positionPlayed, createdAt: new Date().toISOString() }); addedCount++; }
        }
        showToast(`${addedCount} pemain berhasil didaftarkan`);
        document.getElementById('regPlayerSearch').value = ''; 
    }
    window.deleteRegistration = async function(regId) { if(confirm('Hapus pemain?')) await deleteData(regId); }

    // ... Team Generator Logic ...
    window.openTeamGenerator = function(id) {
        if(id) currentMatchIdForReg = id;
        if(!currentMatchIdForReg) return;
        const schedule = allData.find(d => d.__backendId === currentMatchIdForReg);
        if (!schedule) return;
        document.getElementById('teamGeneratorModal').classList.remove('hidden');
        if (schedule.generated_teams && Array.isArray(schedule.generated_teams) && schedule.generated_teams.length > 0) {
            tempGeneratedTeams = schedule.generated_teams;
            renderGeneratedTeams(tempGeneratedTeams);
        } else {
            document.getElementById('genTeamContainer').innerHTML = '<div class="col-span-full text-center text-gray-400 py-20 flex flex-col items-center flex-1 justify-center"><div class="text-6xl mb-4">ğŸŸï¸</div><div class="font-bold">Area Taktik Kosong</div><div class="text-sm">Klik "Acak Tim" untuk membangun skuad baru.</div></div>';
        }
    }
    window.closeTeamGeneratorModal = function() { 
        document.getElementById('teamGeneratorModal').classList.add('hidden'); 
        isEditingTeams = false; // Reset edit mode
        if(document.getElementById('btnToggleEdit')) {
             document.getElementById('btnToggleEdit').classList.remove('bg-amber-100', 'border-amber-400', 'text-amber-800');
             document.getElementById('btnToggleEdit').innerHTML = 'âœï¸ Mode Edit';
        }
    }
    window.generateTeamsLogic = function() {
        const schedule = allData.find(d => d.__backendId === currentMatchIdForReg);
        const registrations = allData.filter(d => d.type === 'registration' && d.schedule_id === currentMatchIdForReg);
        if (registrations.length < 2) { showToast('Minimal 2 pemain untuk generate', 'error'); return; }
        let shuffled = [...registrations].sort(() => 0.5 - Math.random());
        let numTeams = schedule.schedule_type === 'Fun Football' ? 4 : 2;
        const teams = [];
        const chunkSize = Math.ceil(shuffled.length / numTeams);
        for (let i = 0; i < numTeams; i++) {
            const teamChunk = shuffled.slice(i * chunkSize, (i + 1) * chunkSize);
            let defaultName = `Tim ${String.fromCharCode(65 + i)}`; 
            if(numTeams === 2) defaultName = i === 0 ? "Home Team" : "Away Team";
            teams.push({ name: defaultName, players: teamChunk });
        }
        tempGeneratedTeams = teams; 
        
        // Reset Edit Mode when regenerating
        isEditingTeams = false;
        const btnEdit = document.getElementById('btnToggleEdit');
        if(btnEdit) {
            btnEdit.classList.remove('bg-amber-100', 'border-amber-400', 'text-amber-800');
            btnEdit.innerHTML = 'âœï¸ Mode Edit';
        }
        
        renderGeneratedTeams(teams);
    }
    window.saveGeneratedTeams = async function() {
        if (!currentMatchIdForReg || tempGeneratedTeams.length === 0) { showToast('Tidak ada tim untuk disimpan', 'error'); return; }
        await updateDocWrapper(currentMatchIdForReg, { generated_teams: tempGeneratedTeams });
        showToast('Formasi Tim tersimpan permanen!');
    }
    
    window.pushToMatchRecap = async function() {
        if(!currentMatchIdForReg) { showToast('Error: ID Jadwal hilang', 'error'); return; } 
        if(tempGeneratedTeams.length === 0) { showToast('Generate tim dulu!', 'error'); return; }
        await saveGeneratedTeams(); 
        const schedule = allData.find(d => d.__backendId === currentMatchIdForReg);
        if (!schedule) return;
        if(tempGeneratedTeams.length === 2) {
              await createData({ type: 'match', opponent: tempGeneratedTeams[1].name + " (Away)", date: schedule.date, location: schedule.location, match_type: schedule.schedule_type, score_us: 0, score_opponent: 0, description: `Generated: ${tempGeneratedTeams[0].name} vs ${tempGeneratedTeams[1].name}`, createdAt: new Date().toISOString() });
        } else {
              const teamNames = tempGeneratedTeams.map(t => t.name).join(', ');
              await createData({ type: 'match', opponent: "Internal Game (4 Tim)", date: schedule.date, location: schedule.location, match_type: schedule.schedule_type, score_us: 0, score_opponent: 0, description: `Teams: ${teamNames}`, createdAt: new Date().toISOString() });
        }
        showToast('Terkirim ke Match History!');
        closeTeamGeneratorModal();
        closeMatchRegModal();
    }
    
    window.toggleEditTeams = function() {
        if(tempGeneratedTeams.length === 0) return;
        isEditingTeams = !isEditingTeams;
        const btn = document.getElementById('btnToggleEdit');
        if(isEditingTeams) {
            btn.classList.add('bg-amber-100', 'border-amber-400', 'text-amber-800');
            btn.innerHTML = 'âœ… Selesai Edit';
            showToast('Mode Edit Aktif: Klik panah pada pemain untuk memindahkannya.');
        } else {
            btn.classList.remove('bg-amber-100', 'border-amber-400', 'text-amber-800');
            btn.innerHTML = 'âœï¸ Mode Edit';
        }
        renderGeneratedTeams(tempGeneratedTeams);
    }
    
    window.movePlayer = function(teamIdx, playerIdx) {
        // 1. Get player
        const player = tempGeneratedTeams[teamIdx].players[playerIdx];
        
        // 2. Remove from current team
        tempGeneratedTeams[teamIdx].players.splice(playerIdx, 1);
        
        // 3. Determine next team (cyclic)
        const nextTeamIdx = (teamIdx + 1) % tempGeneratedTeams.length;
        
        // 4. Add to next team
        tempGeneratedTeams[nextTeamIdx].players.push(player);
        
        // 5. Re-render UI
        renderGeneratedTeams(tempGeneratedTeams);
    }

    window.renderGeneratedTeams = function(teams) {
        const container = document.getElementById('genTeamContainer');
        const formation = document.getElementById('genFormation').value;
        container.innerHTML = teams.map((t, idx) => {
            // Updated Colors for 4 teams support
            const colors = [
                { bg: "bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 border-blue-500/50", accent: "text-blue-400", badge: "bg-blue-600" }, // Team A (Home)
                { bg: "bg-gradient-to-br from-slate-900 via-red-900 to-slate-900 border-red-500/50", accent: "text-red-400", badge: "bg-red-600" }, // Team B (Away)
                { bg: "bg-gradient-to-br from-slate-900 via-green-900 to-slate-900 border-green-500/50", accent: "text-green-400", badge: "bg-green-600" }, // Team C
                { bg: "bg-gradient-to-br from-slate-900 via-yellow-900 to-slate-900 border-yellow-500/50", accent: "text-yellow-400", badge: "bg-yellow-600" } // Team D
            ];
            
            const theme = colors[idx % colors.length];
            
            return `
            <div class="${theme.bg} relative rounded-2xl p-6 shadow-2xl border-2 overflow-hidden group hover:scale-[1.01] transition-transform duration-300 flex flex-col min-w-[300px] w-full max-w-[350px] flex-shrink-0 h-full">
                <div class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
                <div class="absolute -right-10 -top-10 text-9xl text-white opacity-5 rotate-12 pointer-events-none select-none">ğŸ›¡ï¸</div>
                <div class="relative z-10 flex flex-col h-full">
                    <div class="text-center mb-6 flex-shrink-0">
                        <div class="inline-block px-3 py-1 ${theme.badge} text-white text-[10px] font-bold uppercase tracking-widest rounded-full mb-2 shadow-lg border border-white/20">${formation}</div>
                        <input type="text" value="${t.name}" onchange="updateTeamName(${idx}, this.value)" class="w-full font-head font-bold text-3xl text-white bg-transparent border-b-2 border-white/10 focus:border-amber-400 focus:outline-none text-center pb-2 transition-colors placeholder-white/30 hover:border-white/30 admin-only:pointer-events-none">
                    </div>
                    <div class="space-y-2 overflow-y-auto pr-2 custom-scrollbar flex-1 max-h-[400px]">
                        ${t.players.map((p, pIdx) => {
                            let displayPos = p.position_played;
                            if (!displayPos || displayPos === 'PLAYER') {
                                const memberRef = allData.find(m => m.__backendId === p.member_id);
                                displayPos = memberRef ? memberRef.position : 'PLAYER';
                            }
                            
                            // Move Button Logic - Only shows if isEditingTeams is true
                            const moveBtn = isEditingTeams 
                                ? `<button onclick="movePlayer(${idx}, ${pIdx})" class="ml-2 bg-amber-500 hover:bg-amber-400 text-slate-900 w-7 h-7 flex items-center justify-center rounded-full text-xs font-bold transition shadow-md animate-pulse" title="Pindah ke Tim Berikutnya">â‡„</button>` 
                                : '';
                            
                            return `<div class="flex items-center gap-3 bg-white/5 hover:bg-white/10 p-2.5 rounded-xl border border-white/5 transition-all group-hover:border-white/20">
                                <div class="w-8 h-8 rounded-full bg-gradient-to-br from-white/10 to-white/5 flex items-center justify-center text-xs font-bold text-white shadow-inner border border-white/10">${pIdx + 1}</div>
                                <div class="flex-1">
                                    <div class="text-sm font-semibold text-gray-100 tracking-wide">${p.member_name}</div>
                                    <div class="text-[10px] text-gray-400 uppercase tracking-wider">${displayPos}</div>
                                </div>
                                ${pIdx === 0 ? '<span class="text-base animate-pulse" title="Captain">Â©ï¸</span>' : ''}
                                ${moveBtn}
                            </div>`
                        }).join('')}
                    </div>
                    <div class="mt-6 pt-4 border-t border-white/10 flex justify-between text-xs text-gray-400 font-mono uppercase tracking-widest flex-shrink-0"><span>Total: ${t.players.length} Pemain</span><span class="${theme.accent} font-bold flex items-center gap-1">â— Ready</span></div>
                </div>
            </div>`;
        }).join('');
    }
    window.updateTeamName = function(idx, newName) { if(tempGeneratedTeams[idx]) tempGeneratedTeams[idx].name = newName; }

    function renderSchedules() { 
        const list = document.getElementById('scheduleList');
        if (!list) return;
        let schedules = allData.filter(d=>d.type==='schedule');
        if (searchQuery) schedules = schedules.filter(s => s.name.toLowerCase().includes(searchQuery) || s.location.toLowerCase().includes(searchQuery));
        schedules.sort((a,b) => new Date(a.date + 'T' + (a.time || '00:00')) - new Date(b.date + 'T' + (b.time || '00:00')));
        if(schedules.length === 0) { list.innerHTML = `<div class="text-center py-10 bg-gray-50 rounded-2xl border-2 border-dashed border-gray-200"><div class="text-4xl mb-2">ğŸ“…</div><p class="text-gray-500 font-semibold">Belum ada agenda.</p><p class="text-gray-400 text-sm">Istirahatlah sejenak, Baginda.</p></div>`; return; }
        
        list.innerHTML = schedules.map(s => {
            const dateObj = new Date(s.date); const dayName = dateObj.toLocaleDateString('id-ID', { weekday: 'long' }); const dayDate = dateObj.getDate(); const monthName = dateObj.toLocaleDateString('id-ID', { month: 'short' });
            const today = new Date(); today.setHours(0,0,0,0); const eventDate = new Date(s.date + 'T' + (s.time || '00:00')); const diffTime = eventDate - today; const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            let countdownBadge = diffDays > 0 ? `<div class="absolute top-0 right-0 bg-amber-400 text-slate-900 text-[10px] font-bold px-3 py-1 rounded-bl-xl shadow-md z-20">H-${diffDays}</div>` : (diffDays === 0 ? `<div class="absolute top-0 right-0 bg-red-500 text-white text-[10px] font-bold px-3 py-1 rounded-bl-xl shadow-md z-20 animate-pulse">HARI INI!</div>` : `<div class="absolute top-0 right-0 bg-gray-600 text-gray-300 text-[10px] font-bold px-3 py-1 rounded-bl-xl shadow-md z-20">SELESAI</div>`);
            const currentRegs = allData.filter(d => d.type === 'registration' && d.schedule_id === s.__backendId).length;
            const viewTeamsBtn = s.generated_teams ? `<button onclick="event.stopPropagation(); openTeamGenerator('${s.__backendId}')" class="bg-purple-500 text-white text-[10px] font-bold px-2 py-0.5 rounded hover:bg-purple-600 transition ml-2">ğŸ‘€ LIHAT TIM</button>` : '';
            let cardBg = s.schedule_type === 'Friendly Match' ? 'bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900 border border-indigo-500/30' : 'bg-gradient-to-br from-emerald-800 to-teal-900 border border-emerald-500/30';
            
            let vsSection = s.schedule_type === 'Friendly Match' 
                ? `<div class="flex items-center gap-3 mt-2 mb-3"><div class="text-center"><div class="w-10 h-10 sm:w-12 sm:h-12 bg-white rounded-full flex items-center justify-center text-sm font-bold text-slate-900 shadow-lg border-2 border-amber-400">MF</div><div class="text-[9px] mt-1 font-bold tracking-wider text-amber-400">KAMI</div></div><div class="text-2xl font-bold font-head text-white/20 italic">VS</div><div class="text-center"><div class="w-10 h-10 sm:w-12 sm:h-12 bg-slate-700 rounded-full flex items-center justify-center text-lg font-bold text-white shadow-lg border-2 border-slate-500">${s.name.charAt(0).toUpperCase()}</div><div class="text-[9px] mt-1 font-bold tracking-wider text-slate-400">LAWAN</div></div></div><div class="text-lg font-bold text-white leading-tight truncate w-full text-center sm:text-left border-b border-white/10 pb-2 mb-2">${s.name}</div>`
                : `<div class="flex items-center gap-2 mt-2 mb-3"><span class="p-2 bg-white/10 rounded-lg text-xl">âš½</span><span class="p-2 bg-white/10 rounded-lg text-xl">ğŸƒ</span><span class="p-2 bg-white/10 rounded-lg text-xl">ğŸ¥…</span></div><div class="text-lg font-bold text-white leading-tight truncate w-full text-center sm:text-left border-b border-white/10 pb-2 mb-2">${s.name}</div>`;

            let teamPreview = '';
            if (s.generated_teams && Array.isArray(s.generated_teams) && s.generated_teams.length > 0) {
                teamPreview = `
                <div class="mt-3 w-full bg-black/40 rounded-xl p-3 border border-white/10 backdrop-blur-sm cursor-pointer hover:bg-black/50 transition group/team" onclick="event.stopPropagation(); openTeamGenerator('${s.__backendId}')">
                    <div class="flex justify-between items-center mb-2 border-b border-white/10 pb-1">
                        <div class="text-[9px] font-bold uppercase text-gray-400 tracking-widest">LINE-UP TERKINI</div>
                        <div class="text-[9px] text-amber-400 group-hover/team:underline">Edit / Detail âœ</div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                        ${s.generated_teams.map(t => `
                            <div class="bg-white/5 p-2 rounded border border-white/5">
                                <div class="font-bold text-[10px] text-white truncate mb-0.5">${t.name}</div>
                                <div class="text-[9px] text-gray-400 truncate">${t.players.length} Pemain</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                `;
            }

            return `
            <div class="${cardBg} rounded-2xl p-5 shadow-lg relative overflow-hidden group hover:shadow-xl hover:scale-[1.01] transition-all duration-300">
                <div class="absolute inset-0 opacity-5 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
                ${countdownBadge}
                <div class="relative z-10 flex flex-col sm:flex-row items-start gap-6">
                    <div class="flex-shrink-0 flex flex-col items-center justify-center bg-black/30 backdrop-blur-sm rounded-xl p-3 border border-white/10 w-20 h-24 sm:h-auto self-start">
                        <span class="text-xs font-bold text-amber-400 uppercase tracking-widest mb-1">${monthName}</span>
                        <span class="text-4xl font-bold font-head text-white leading-none mb-1">${dayDate}</span>
                        <span class="text-[10px] text-gray-400 uppercase font-semibold">${dayName.substring(0,3)}</span>
                    </div>
                    <div class="flex-1 flex flex-col items-center sm:items-start w-full">
                        <div class="flex items-center mb-1 w-full justify-between sm:justify-start">
                            <div class="inline-block px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider bg-white/10 text-white/80 border border-white/5">${s.schedule_type}</div>
                            ${viewTeamsBtn}
                        </div>
                        ${vsSection}
                        <div class="flex flex-wrap justify-center sm:justify-start items-center gap-4 text-sm text-gray-300 w-full mb-2">
                            <div class="flex items-center gap-1.5 bg-black/20 px-3 py-1.5 rounded-full border border-white/5"><span class="text-amber-400">â°</span> <span class="font-mono font-bold">${s.time} WIB</span></div>
                            <div class="flex items-center gap-1.5 max-w-[200px] truncate"><span>ğŸ“</span> <span>${s.location}</span></div>
                        </div>
                        <div class="w-full bg-black/20 rounded-full h-8 relative flex items-center px-3 border border-white/10 cursor-pointer hover:bg-black/30 transition mb-2" onclick="openMatchRegModal('${s.__backendId}')">
                            <div class="text-[10px] text-white/80 z-10 flex-1">ğŸ‘¥ Squad: <span class="font-bold text-amber-400">${currentRegs}</span> Pemain</div>
                            <button class="bg-white/20 text-white text-[10px] font-bold px-2 py-0.5 rounded hover:bg-amber-500 hover:text-black transition">LIHAT / KELOLA</button>
                        </div>
                        ${teamPreview}
                    </div>
                    <div class="flex sm:flex-col gap-2 mt-2 sm:mt-0 self-start">
                        <button onclick="window.open('https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.location)}', '_blank')" class="w-10 h-10 rounded-full bg-white/5 hover:bg-amber-500 hover:text-slate-900 text-white flex items-center justify-center transition border border-white/10 backdrop-blur" title="Buka Peta">ğŸ—ºï¸</button>
                        <button onclick="deleteSchedule('${s.__backendId}')" class="admin-only w-10 h-10 rounded-full bg-red-500/20 hover:bg-red-500 text-red-300 hover:text-white flex items-center justify-center transition border border-red-500/30 backdrop-blur" title="Hapus Jadwal">ğŸ—‘ï¸</button>
                    </div>
                </div>
            </div>`;
        }).join(''); 
    }

    // --- FUNGSI BARU: ISI DROPDOWN JADWAL ---
    window.populateScheduleDropdown = function() {
       const select = document.getElementById('matchScheduleRef');
       if(!select) return;
       const schedules = allData.filter(d => d.type === 'schedule').sort((a,b) => new Date(b.date) - new Date(a.date));
       
       let html = '<option value="">-- Pilih Jadwal --</option>';
       schedules.forEach(s => {
           const hasTeams = s.generated_teams && s.generated_teams.length > 0 ? 'âœ… Tim Ready' : 'âš ï¸ Belum Generate';
           html += `<option value="${s.__backendId}">${s.name} (${s.date}) - ${hasTeams}</option>`;
       });
       select.innerHTML = html;
    }

    // 1. RENDER FORM MATCH (4 BABAK)
    window.renderMatchInputForm = function() {
        const scheduleId = document.getElementById('matchScheduleRef').value;
        const type = document.getElementById('matchType').value;
        const container = document.getElementById('dynamicScoreInput');
        const opponentInputRef = document.getElementById('matchOpponent');
        
        if(scheduleId) {
            const sched = allData.find(d => d.__backendId === scheduleId);
            if(sched) {
                document.getElementById('matchDate').value = sched.date;
                document.getElementById('matchLocation').value = sched.location;
                if(!type) document.getElementById('matchType').value = sched.schedule_type;
            }
        }

        if (type === 'Friendly Match') {
            opponentInputRef.classList.remove('hidden');
            let teamOptions = '<option value="">-- Pilih Tim --</option>';
            let hasTeams = false;
            
            if(scheduleId) {
                const sched = allData.find(d => d.__backendId === scheduleId);
                if(sched && sched.generated_teams && sched.generated_teams.length > 0) {
                    hasTeams = true;
                    sched.generated_teams.forEach(t => { teamOptions += `<option value="${t.name}">${t.name}</option>`; });
                    if(opponentInputRef.value === '') opponentInputRef.value = sched.name; 
                }
            }

            if (!hasTeams) {
                container.innerHTML = `<div class="bg-red-50 p-3 rounded text-red-600 text-center text-sm font-bold">âš ï¸ Belum ada Tim Generated di Jadwal ini.<br>Silakan ke menu JADWAL > Generate Tim dulu.</div>`;
                return;
            }

            container.innerHTML = `
                <div class="mb-4 p-3 bg-blue-50 rounded-xl border border-blue-100">
                    <p class="text-[10px] font-bold text-blue-500 uppercase mb-2">ROTASI TIM INTERNAL (A-B-A-B)</p>
                    <div class="grid grid-cols-2 gap-3">
                        <div><label class="text-xs font-bold text-gray-500">Tim Rotasi 1 (Q1 & Q3)</label><select id="friend_team_a" onchange="updateFriendlyLabels()" class="w-full border rounded p-1 text-sm font-bold text-slate-700 bg-white">${teamOptions}</select></div>
                        <div><label class="text-xs font-bold text-gray-500">Tim Rotasi 2 (Q2 & Q4)</label><select id="friend_team_b" onchange="updateFriendlyLabels()" class="w-full border rounded p-1 text-sm font-bold text-slate-700 bg-white">${teamOptions}</select></div>
                    </div>
                </div>
                <div class="space-y-2">
                    ${[1,2,3,4].map(q => `
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 rounded bg-slate-200 flex items-center justify-center font-bold text-xs">Q${q}</div>
                        <div class="flex-1 flex items-center bg-white border rounded px-2 py-1">
                            <span id="lbl_f_q${q}" class="text-xs font-bold ${q%2!==0?'text-blue-600':'text-green-600'} w-20 truncate">Tim ${q%2!==0?'A':'B'}</span>
                            <input type="number" id="sc_f_q${q}_us" class="w-10 text-center font-bold border-b mx-1 focus:outline-none" placeholder="0" onkeyup="calcFriendlyTotal()">
                            <span class="text-gray-400 mx-1">:</span>
                            <input type="number" id="sc_f_q${q}_op" class="w-10 text-center font-bold border-b mx-1 focus:outline-none" placeholder="0" onkeyup="calcFriendlyTotal()">
                            <span class="text-xs text-gray-400 ml-auto font-bold text-red-500">Lawan</span>
                        </div>
                    </div>`).join('')}
                </div>
                <div class="mt-4 flex justify-between items-center bg-slate-800 text-white p-3 rounded-xl">
                    <span class="text-xs font-bold uppercase tracking-widest text-slate-400">Total Agg</span>
                    <div class="flex items-center gap-3"><span id="total_friendly_us" class="text-2xl font-bold font-head text-amber-400">0</span><span class="text-sm text-gray-500">-</span><span id="total_friendly_op" class="text-2xl font-bold font-head text-white">0</span></div>
                </div>`;

        } else if (type === 'Fun Football') {
            opponentInputRef.classList.add('hidden');
            let teamOptions = '<option value="">Pilih Tim...</option>';
            if(scheduleId) {
                const sched = allData.find(d => d.__backendId === scheduleId);
                if(sched && sched.generated_teams) sched.generated_teams.forEach(t => { teamOptions += `<option value="${t.name}">${t.name}</option>`; });
            }
            let html = `<div class="text-center font-bold text-slate-700 mb-3 border-b pb-2">INTERNAL MATCH</div><div class="space-y-3">`;
            for(let i=1; i<=4; i++) {
                html += `<div class="bg-white p-3 rounded-xl border border-gray-200 shadow-sm"><div class="text-[10px] font-bold text-gray-400 mb-1">MATCH ${i}</div><div class="flex items-center gap-2"><select id="int_m${i}_t1" class="w-full text-xs border rounded p-1 font-bold text-blue-700">${teamOptions}</select><input type="number" id="int_m${i}_s1" class="w-12 text-center border rounded p-1 font-bold" placeholder="0"><span class="text-gray-400 font-bold">-</span><input type="number" id="int_m${i}_s2" class="w-12 text-center border rounded p-1 font-bold" placeholder="0"><select id="int_m${i}_t2" class="w-full text-xs border rounded p-1 font-bold text-red-700">${teamOptions}</select></div></div>`;
            }
            container.innerHTML = html + `</div>`;
        } else {
            container.innerHTML = `<p class="text-center text-gray-400 italic text-sm">Pilih jenis match terlebih dahulu...</p>`;
        }
    }

    // 2. HELPER CALCULATOR
    window.updateFriendlyLabels = function() {
        const teamA = document.getElementById('friend_team_a').value || 'Tim A';
        const teamB = document.getElementById('friend_team_b').value || 'Tim B';
        if(document.getElementById('lbl_f_q1')) document.getElementById('lbl_f_q1').textContent = teamA;
        if(document.getElementById('lbl_f_q2')) document.getElementById('lbl_f_q2').textContent = teamB;
        if(document.getElementById('lbl_f_q3')) document.getElementById('lbl_f_q3').textContent = teamA;
        if(document.getElementById('lbl_f_q4')) document.getElementById('lbl_f_q4').textContent = teamB;
    }
    window.calcFriendlyTotal = function() {
        let us = 0, op = 0;
        for(let i=1; i<=4; i++) {
            us += parseInt(document.getElementById(`sc_f_q${i}_us`).value) || 0;
            op += parseInt(document.getElementById(`sc_f_q${i}_op`).value) || 0;
        }
        document.getElementById('total_friendly_us').textContent = us;
        document.getElementById('total_friendly_op').textContent = op;
    }

    // 3. FUNGSI SIMPAN (LOGIC BARU)
    window.addMatch = async function() { 
        const scheduleId = document.getElementById('matchScheduleRef').value;
        const type = document.getElementById('matchType').value;
        const date = document.getElementById('matchDate').value;
        const location = document.getElementById('matchLocation').value;
        
        if (!type || !date) { showToast('Lengkapi data match!', 'error'); return; }

        let dataPayload = { type:'match', schedule_ref: scheduleId, date, location, match_type: type, createdAt: new Date().toISOString() };

        if (type === 'Friendly Match') {
            const teamA = document.getElementById('friend_team_a').value;
            const teamB = document.getElementById('friend_team_b').value;
            const opponentName = document.getElementById('matchOpponent').value || 'Lawan';
            if(!teamA || !teamB) { showToast('Pilih Tim Rotasi A dan B', 'error'); return; }

            const scores = [];
            let totalUs = 0, totalOp = 0;
            for(let i=1; i<=4; i++){
                let u = parseInt(document.getElementById(`sc_f_q${i}_us`).value)||0;
                let o = parseInt(document.getElementById(`sc_f_q${i}_op`).value)||0;
                scores.push({ q: i, team_internal: (i%2!==0?teamA:teamB), us: u, op: o });
                totalUs += u; totalOp += o;
            }
            dataPayload.opponent = opponentName; dataPayload.score_us = totalUs; dataPayload.score_opponent = totalOp; dataPayload.details = scores;
            dataPayload.result = totalUs > totalOp ? 'Menang' : (totalUs == totalOp ? 'Seri' : 'Kalah');

        } else if (type === 'Fun Football') {
            const matches = [];
            for(let i=1; i<=4; i++) {
                const t1 = document.getElementById(`int_m${i}_t1`).value;
                const t2 = document.getElementById(`int_m${i}_t2`).value;
                const s1 = document.getElementById(`int_m${i}_s1`).value || 0;
                const s2 = document.getElementById(`int_m${i}_s2`).value || 0;
                if(t1 && t2) matches.push({ t1, t2, s1, s2 });
            }
            if(matches.length === 0) { showToast('Isi minimal 1 match', 'error'); return; }
            dataPayload.opponent = "Internal Game"; dataPayload.score_us = 0; dataPayload.score_opponent = 0; dataPayload.details = matches; dataPayload.result = 'Internal';
        }

        await createData(dataPayload); 
        showToast('Hasil Match Disimpan!'); 
        renderCurrentView();
        document.getElementById('matchInputSection').scrollIntoView();
        document.getElementById('matchScheduleRef').value = "";
        document.getElementById('dynamicScoreInput').innerHTML = '<p class="text-center text-gray-400 italic text-sm">Pilih jadwal...</p>';
    }

    function renderMatches() { 
        const list = document.getElementById('matchList');
        if (!list) return;
        let matches = allData.filter(d=>d.type==='match');
        if (searchQuery) {
            matches = matches.filter(m => m.opponent.toLowerCase().includes(searchQuery) || m.location.toLowerCase().includes(searchQuery));
        }
        
        matches.sort((a,b) => new Date(b.date) - new Date(a.date));

        // Update Summary Stats
        let wins = 0, draws = 0, losses = 0;
        matches.forEach(m => {
            const us = parseInt(m.score_us) || 0;
            const op = parseInt(m.score_opponent) || 0;
            if (us > op) wins++;
            else if (us === op) draws++;
            else losses++;
        });
        if(document.getElementById('summaryWin')) document.getElementById('summaryWin').textContent = wins;
        if(document.getElementById('summaryDraw')) document.getElementById('summaryDraw').textContent = draws;
        if(document.getElementById('summaryLoss')) document.getElementById('summaryLoss').textContent = losses;

        if (matches.length === 0) {
            list.innerHTML = `<div class="text-center py-10 bg-gray-50 rounded-2xl border-2 border-dashed border-gray-200"><div class="text-4xl mb-2">âš½</div><p class="text-gray-500 font-semibold">Belum ada riwayat pertandingan.</p></div>`;
            return;
        }

        list.innerHTML = matches.map(m => {
            const us = parseInt(m.score_us) || 0;
            const op = parseInt(m.score_opponent) || 0;
            let resultClass = "";
            let resultLabel = "";
            let scoreColor = "";
            
            if (us > op) { 
                resultClass = "bg-green-100 text-green-700 border-green-200"; 
                resultLabel = "WIN"; 
                scoreColor = "text-green-600";
            } else if (us === op) { 
                resultClass = "bg-gray-100 text-gray-600 border-gray-200"; 
                resultLabel = "DRAW"; 
                scoreColor = "text-gray-600";
            } else { 
                resultClass = "bg-red-100 text-red-700 border-red-200"; 
                resultLabel = "LOSS"; 
                scoreColor = "text-red-600";
            }

            const dateObj = new Date(m.date);
            const dateStr = dateObj.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
            
            return `
            <div class="bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden hover:shadow-lg transition-all relative group">
                <div class="absolute top-0 left-0 w-1 h-full ${us > op ? 'bg-green-500' : (us === op ? 'bg-gray-400' : 'bg-red-500')}"></div>
                <div class="p-4 sm:p-5">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] font-bold px-2 py-1 rounded border ${resultClass}">${resultLabel}</span>
                            <span class="text-xs text-gray-400 font-medium">${m.match_type}</span>
                        </div>
                        <span class="text-xs text-gray-500 font-medium flex items-center gap-1">ğŸ“… ${dateStr}</span>
                    </div>
                    
                    <div class="flex items-center justify-between gap-2 sm:gap-4 mb-4">
                        <div class="flex-1 flex flex-col items-center justify-center text-center">
                            <div class="w-12 h-12 sm:w-14 sm:h-14 bg-white rounded-full border-2 border-amber-400 shadow-sm flex items-center justify-center text-slate-800 font-bold text-sm mb-2">MF</div>
                            <h4 class="text-xs sm:text-sm font-bold text-slate-800 line-clamp-1">Muslim Footballers</h4>
                        </div>
                        
                        <div class="flex flex-col items-center justify-center px-2">
                            <div class="text-3xl sm:text-4xl font-head font-bold ${scoreColor} tracking-widest">${us} - ${op}</div>
                            <div class="text-[10px] text-gray-400 font-bold uppercase tracking-widest mt-1">Full Time</div>
                        </div>
                        
                        <div class="flex-1 flex flex-col items-center justify-center text-center">
                            <div class="w-12 h-12 sm:w-14 sm:h-14 bg-slate-100 rounded-full border-2 border-slate-200 shadow-sm flex items-center justify-center text-slate-500 font-bold text-lg mb-2 overflow-hidden">
                                ${m.opponent.charAt(0).toUpperCase()}
                            </div>
                            <h4 class="text-xs sm:text-sm font-bold text-slate-800 line-clamp-1">${m.opponent}</h4>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between pt-3 border-t border-gray-50">
                        <div class="text-xs text-gray-400 flex items-center gap-1 max-w-[60%] truncate">
                            ğŸ“ ${m.location || 'Bandung'}
                        </div>
                        <div class="flex gap-2">
                            <button onclick="inputStatsForMatch('${m.__backendId}')" class="bg-slate-50 hover:bg-slate-100 text-slate-600 border border-slate-200 px-3 py-1.5 rounded-lg text-xs font-bold transition flex items-center gap-1">
                                ğŸ“Š Statistik
                            </button>
                            <button onclick="deleteMatch('${m.__backendId}')" class="admin-only bg-red-50 hover:bg-red-100 text-red-500 border border-red-100 px-3 py-1.5 rounded-lg text-xs font-bold transition">
                                ğŸ—‘ï¸ Hapus
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            `;
        }).join(''); 
    }
    window.deleteMatch = async function(id) { if(confirm('Hapus?')) await deleteData(id); }
    window.inputStatsForMatch = function(id) { showMenu('statistik'); const m=allData.find(d=>d.__backendId===id); if(m) document.getElementById('statsDate').value=m.date; }
    window.updatePlayerDropdown = function() { document.getElementById('statsPlayerName').innerHTML = '<option value="">Pilih</option>' + allData.filter(d=>d.type==='member').map(m=>`<option value="${m.__backendId}">${m.name}</option>`).join(''); }
    window.addStats = async function() {
        const pts = (parseInt(document.getElementById('statsGoals').value)||0)*3 + (parseInt(document.getElementById('statsAssists').value)||0) + (parseInt(document.getElementById('statsSaves').value)||0);
        let bonus = 0;
        if(document.getElementById('statsJersey').checked) bonus += 2;
        if(document.getElementById('statsCleanSheet').checked) bonus += 3;
        if(document.getElementById('statsPOTM').checked) bonus += 3;
        if(document.getElementById('statsBestXI').checked) bonus += 3;
        
        await createData({ type:'stats', member_id:document.getElementById('statsPlayerName').value, date:document.getElementById('statsDate').value, goals:document.getElementById('statsGoals').value, assists:document.getElementById('statsAssists').value, saves:document.getElementById('statsSaves').value, totalPoints: pts + bonus, createdAt:new Date().toISOString() });
        showToast('Statistik disimpan');
        
        document.getElementById('statsGoals').value = '';
        document.getElementById('statsAssists').value = '';
        document.getElementById('statsSaves').value = '';
    }
    
    function renderStats() { 
        const statsMap = {};
        
        allData.filter(d => d.type === 'stats').forEach(s => {
            const mid = s.member_id;
            if (!statsMap[mid]) {
                statsMap[mid] = { 
                    id: mid, 
                    goals: 0, 
                    assists: 0, 
                    saves: 0, 
                    points: 0, 
                    matches: 0 
                };
            }
            statsMap[mid].goals += (parseInt(s.goals) || 0);
            statsMap[mid].assists += (parseInt(s.assists) || 0);
            statsMap[mid].saves += (parseInt(s.saves) || 0);
            statsMap[mid].points += (parseInt(s.totalPoints) || 0);
            statsMap[mid].matches += 1;
        });

        const sortedStats = Object.values(statsMap).sort((a, b) => b.points - a.points);
        const enrichedStats = sortedStats.map(stat => {
            const member = allData.find(m => m.__backendId === stat.id);
            return { ...stat, name: member ? member.name : 'Unknown', position: member ? member.position : '-', photo: member ? member.photo : '' };
        });

        const podiumContainer = document.getElementById('statsPodium');
        const listContainer = document.getElementById('statsList');
        
        if(!podiumContainer || !listContainer) return;

        let podiumHTML = '';
        if (enrichedStats.length > 0) {
            const top3 = [];
            const rank1 = enrichedStats[0];
            const rank2 = enrichedStats.length > 1 ? enrichedStats[1] : null;
            const rank3 = enrichedStats.length > 2 ? enrichedStats[2] : null;

            if (rank2) {
                podiumHTML += `
                <div class="flex flex-col items-center order-1 md:order-1 transform hover:scale-105 transition duration-300">
                    <div class="relative">
                        <div class="w-16 h-16 md:w-20 md:h-20 rounded-full border-4 border-slate-300 bg-slate-100 overflow-hidden shadow-lg mb-2">
                            <img src="${rank2.photo || 'https://via.placeholder.com/150?text='+rank2.name.charAt(0)}" class="w-full h-full object-cover">
                        </div>
                        <div class="absolute -bottom-2 -right-2 bg-slate-400 text-white w-6 h-6 flex items-center justify-center rounded-full font-bold text-xs shadow border border-white">2</div>
                    </div>
                    <div class="text-center mt-2">
                        <h4 class="font-bold text-slate-700 text-sm truncate w-24 md:w-32">${rank2.name}</h4>
                        <div class="text-slate-500 text-xs font-bold">${rank2.points} Pts</div>
                    </div>
                    <div class="h-16 w-full bg-gradient-to-t from-slate-300 to-slate-100 rounded-t-lg mt-2 shadow-inner"></div>
                </div>`;
            } else { podiumHTML += `<div class="hidden md:block"></div>`; }

            if (rank1) {
                podiumHTML += `
                <div class="flex flex-col items-center order-0 md:order-2 z-10 transform hover:scale-110 transition duration-300 -mt-6">
                    <div class="relative">
                        <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-2xl">ğŸ‘‘</div>
                        <div class="w-20 h-20 md:w-24 md:h-24 rounded-full border-4 border-yellow-400 bg-yellow-50 overflow-hidden shadow-xl mb-2">
                            <img src="${rank1.photo || 'https://via.placeholder.com/150?text='+rank1.name.charAt(0)}" class="w-full h-full object-cover">
                        </div>
                        <div class="absolute -bottom-2 -right-2 bg-yellow-500 text-white w-8 h-8 flex items-center justify-center rounded-full font-bold text-sm shadow border-2 border-white">1</div>
                    </div>
                    <div class="text-center mt-2">
                        <h4 class="font-bold text-slate-800 text-base truncate w-28 md:w-40">${rank1.name}</h4>
                        <div class="text-amber-500 text-sm font-bold">${rank1.points} Pts</div>
                    </div>
                    <div class="h-24 w-full bg-gradient-to-t from-yellow-300 via-yellow-100 to-white rounded-t-lg mt-2 shadow-lg border-t border-white flex items-end justify-center pb-2">
                        <span class="text-[10px] font-bold text-yellow-700 opacity-50">TOP PLAYER</span>
                    </div>
                </div>`;
            }

            if (rank3) {
                podiumHTML += `
                <div class="flex flex-col items-center order-2 md:order-3 transform hover:scale-105 transition duration-300">
                    <div class="relative">
                        <div class="w-16 h-16 md:w-20 md:h-20 rounded-full border-4 border-orange-300 bg-orange-50 overflow-hidden shadow-lg mb-2">
                            <img src="${rank3.photo || 'https://via.placeholder.com/150?text='+rank3.name.charAt(0)}" class="w-full h-full object-cover">
                        </div>
                        <div class="absolute -bottom-2 -right-2 bg-orange-500 text-white w-6 h-6 flex items-center justify-center rounded-full font-bold text-xs shadow border border-white">3</div>
                    </div>
                    <div class="text-center mt-2">
                        <h4 class="font-bold text-slate-700 text-sm truncate w-24 md:w-32">${rank3.name}</h4>
                        <div class="text-orange-500 text-xs font-bold">${rank3.points} Pts</div>
                    </div>
                    <div class="h-12 w-full bg-gradient-to-t from-orange-200 to-orange-50 rounded-t-lg mt-2 shadow-inner"></div>
                </div>`;
            } else { podiumHTML += `<div class="hidden md:block"></div>`; }
        } else {
            podiumHTML = '<div class="col-span-3 text-center text-gray-400 italic py-10">Belum ada data statistik musim ini.</div>';
        }
        podiumContainer.innerHTML = podiumHTML;

        if (enrichedStats.length === 0) {
            listContainer.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-gray-400">Data kosong</td></tr>';
        } else {
            listContainer.innerHTML = enrichedStats.map((p, i) => {
                const rankColor = i === 0 ? 'bg-yellow-100 text-yellow-700' : (i === 1 ? 'bg-slate-100 text-slate-700' : (i === 2 ? 'bg-orange-100 text-orange-700' : 'text-gray-500'));
                const rowBg = i < 3 ? 'bg-white' : 'hover:bg-gray-50';
                
                return `
                <tr class="border-b border-gray-100 ${rowBg} transition-colors">
                    <td class="px-4 py-3 text-center">
                        <span class="w-6 h-6 inline-flex items-center justify-center rounded-full text-xs font-bold ${rankColor}">${i+1}</span>
                    </td>
                    <td class="px-4 py-3">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-gray-200 overflow-hidden hidden sm:block">
                                <img src="${p.photo || 'https://via.placeholder.com/50?text='+p.name.charAt(0)}" class="w-full h-full object-cover">
                            </div>
                            <div>
                                <div class="font-bold text-slate-700 text-sm">${p.name}</div>
                                <div class="text-[10px] text-gray-400 uppercase">${p.position}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-3 text-center text-gray-600 font-medium">${p.matches}</td>
                    <td class="px-4 py-3 text-center font-bold text-green-600 bg-green-50/30">${p.goals}</td>
                    <td class="px-4 py-3 text-center font-bold text-blue-600 bg-blue-50/30">${p.assists}</td>
                    <td class="px-4 py-3 text-center font-bold text-orange-600 bg-orange-50/30">${p.saves}</td>
                    <td class="px-4 py-3 text-center font-black text-amber-600 bg-amber-50 text-base">${p.points}</td>
                </tr>`;
            }).join('');
        }
    }
    window.addInventory = async function() { await createData({ type:'inventory', item_name:document.getElementById('itemName').value, item_image:document.getElementById('itemImage').value, quantity:document.getElementById('itemQuantity').value, condition:document.getElementById('itemCondition').value, createdAt:new Date().toISOString() }); showToast('Item ditambah'); document.getElementById('itemName').value=''; }
    function renderInventory() { document.getElementById('inventoryList').innerHTML = allData.filter(d=>d.type==='inventory').map(i=>`<div class="flex gap-3 p-3 bg-white rounded border items-center hover-lift"><img src="${i.item_image||'https://via.placeholder.com/50'}" class="w-12 h-12 object-cover rounded"><div class="flex-1"><b>${i.item_name}</b> <span class="text-xs bg-gray-200 px-1 rounded">${i.condition}</span><div class="text-xs">Stok: ${i.quantity}</div></div><div class="admin-only flex gap-1"><button onclick="editInventory('${i.__backendId}')" class="text-blue-500">âœï¸</button><button onclick="deleteInventory('${i.__backendId}')" class="text-red-500">ğŸ—‘ï¸</button></div></div>`).join(''); }
    window.editInventory = function(id) { currentEditingRecord=allData.find(d=>d.__backendId===id); if(!currentEditingRecord) return; document.getElementById('editItemName').value=currentEditingRecord.item_name; document.getElementById('editItemImage').value=currentEditingRecord.item_image||''; document.getElementById('editItemQuantity').value=currentEditingRecord.quantity; document.getElementById('editItemCondition').value=currentEditingRecord.condition; document.getElementById('editInventoryModal').classList.remove('hidden'); }
    window.saveEditInventory = async function() { if(!currentEditingRecord) return; await updateData({...currentEditingRecord, item_name:document.getElementById('editItemName').value, item_image:document.getElementById('editItemImage').value, quantity:document.getElementById('editItemQuantity').value, condition:document.getElementById('editItemCondition').value }); showToast('Update berhasil'); closeEditInventoryModal(); }
    window.closeEditInventoryModal = function() { document.getElementById('editInventoryModal').classList.add('hidden'); }
    window.deleteInventory = async function(id) { if(confirm('Hapus?')) await deleteData(id); }
    window.addSponsor = async function() { await createData({ type:'sponsor', sponsor_name:document.getElementById('sponsorName').value, sponsor_image:document.getElementById('sponsorImage').value, contact:document.getElementById('sponsorContact').value, amount:document.getElementById('sponsorAmount').value, tier: document.getElementById('sponsorTier').value, createdAt:new Date().toISOString() }); showToast('Sponsor ditambah'); }
    function renderSponsors() { 
        let list = allData.filter(d=>d.type==='sponsor').sort((a,b) => (parseInt(a.tier)||3) - (parseInt(b.tier)||3) || (parseInt(b.amount)||0) - (parseInt(a.amount)||0));
        const grid = document.getElementById('sponsorListGrid');
        if(!grid) return;
        grid.innerHTML = list.map((s) => {
            const tier = parseInt(s.tier) || 3;
            let tierClass = tier === 1 ? "bg-gradient-to-br from-slate-800 to-slate-900 border-slate-700 text-white" : (tier === 2 ? "bg-gradient-to-br from-amber-500 to-yellow-600 border-amber-400 text-white" : "bg-gradient-to-br from-slate-200 to-gray-300 border-gray-300 text-slate-800");
            let badge = tier === 1 ? "ğŸ‘‘ PLATINUM" : (tier === 2 ? "â­ GOLD" : "ğŸ¥ˆ SILVER");
            return `<div class="${tierClass} relative rounded-2xl p-6 hover-lift group flex flex-col sm:flex-row items-center gap-6 min-h-[160px] overflow-hidden border shadow-lg"><div class="absolute top-0 left-0 bg-white/20 text-[10px] font-bold px-3 py-1 rounded-br-lg shadow-sm z-10">${badge}</div><div class="admin-only absolute top-2 right-2 flex gap-1 z-20 opacity-0 group-hover:opacity-100 transition-opacity"><button onclick="editSponsor('${s.__backendId}')" class="bg-white/20 backdrop-blur p-1 rounded text-xs">âœï¸</button><button onclick="deleteSponsor('${s.__backendId}')" class="bg-red-500/80 backdrop-blur p-1 rounded text-xs">ğŸ—‘ï¸</button></div><div class="w-20 h-20 flex-shrink-0 bg-white rounded-full p-2"><img src="${s.sponsor_image}" class="w-full h-full object-contain" onerror="this.src='https://via.placeholder.com/100'"></div><div class="text-center sm:text-left flex-1"><h4 class="font-bold text-2xl">${s.sponsor_name}</h4><p class="text-sm opacity-80">${s.contact}</p></div></div>`;
        }).join('');
    }
    window.editSponsor = function(id) { currentEditingRecord=allData.find(d=>d.__backendId===id); if(!currentEditingRecord) return; document.getElementById('editSponsorName').value=currentEditingRecord.sponsor_name; document.getElementById('editSponsorImage').value=currentEditingRecord.sponsor_image||''; document.getElementById('editSponsorContact').value=currentEditingRecord.contact; document.getElementById('editSponsorAmount').value=currentEditingRecord.amount; document.getElementById('editSponsorTier').value=currentEditingRecord.tier || '3'; document.getElementById('editSponsorModal').classList.remove('hidden'); }
    window.saveEditSponsor = async function() { if(!currentEditingRecord) return; await updateData({...currentEditingRecord, sponsor_name:document.getElementById('editSponsorName').value, sponsor_image:document.getElementById('editSponsorImage').value, contact:document.getElementById('editSponsorContact').value, amount:document.getElementById('editSponsorAmount').value, tier: document.getElementById('editSponsorTier').value }); showToast('Update berhasil'); closeEditSponsorModal(); }
    window.closeEditSponsorModal = function() { document.getElementById('editSponsorModal').classList.add('hidden'); }
    window.deleteSponsor = async function(id) { if(confirm('Hapus?')) await deleteData(id); }
    window.handleManageSponsor = function() { if(document.body.classList.contains('is-admin')){ document.getElementById('sponsorSectionAdmin').scrollIntoView({behavior: 'smooth'}); } else { showToast('Silakan Login sebagai Admin', 'error'); toggleAdmin(); } }

    window.addGalleryItem = async function() { await createData({ type:'gallery_item', title:document.getElementById('galleryTitle').value, category:document.getElementById('galleryCategory').value, image:document.getElementById('galleryImage').value, description:document.getElementById('galleryDesc').value, createdAt:new Date().toISOString() }); showToast('Foto ditambahkan'); }
    window.filterGallery = function(filter) { currentGalleryFilter = filter; document.querySelectorAll('.gallery-filter').forEach(btn => { if(btn.id === `btn-filter-${filter}`) { btn.classList.remove('bg-white','text-gray-600','border-gray-200'); btn.classList.add('bg-slate-800','text-white','border-slate-700'); } else { btn.classList.add('bg-white','text-gray-600','border-gray-200'); btn.classList.remove('bg-slate-800','text-white','border-slate-700'); } }); renderGallery(); }
    function renderGallery() { const grid = document.getElementById('galleryGrid'); if(!grid) return; let items = allData.filter(d => d.type === 'gallery_item'); if (currentGalleryFilter !== 'all') { items = items.filter(d => d.category === currentGalleryFilter); } if (items.length === 0) { grid.innerHTML = `<div class="col-span-full text-center py-10 text-gray-500 italic">Belum ada foto di kategori ini.</div>`; return; } grid.innerHTML = items.map(item => `<div class="mb-4 break-inside-avoid relative group rounded-2xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 bg-white"><img src="${item.image}" class="w-full h-auto object-cover transform group-hover:scale-105 transition-transform duration-700" onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'"><div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4"><span class="text-[10px] font-bold uppercase tracking-wider text-amber-400 mb-1">${item.category}</span><h3 class="text-white font-bold text-lg leading-tight mb-1">${item.title}</h3><p class="text-gray-300 text-xs line-clamp-2">${item.description}</p><button onclick="deleteGalleryItem('${item.__backendId}')" class="admin-only absolute top-2 right-2 bg-white/20 hover:bg-red-500 text-white p-2 rounded-full backdrop-blur transition">ğŸ—‘ï¸</button></div></div>`).join(''); }
    window.deleteGalleryItem = async function(id) { if(confirm('Hapus foto ini?')) await deleteData(id); }

    window.showToast = function(msg, type='success') { const t = document.createElement('div'); t.className = `fixed top-4 right-4 z-[9999] px-4 py-2 rounded text-white shadow-lg toast ${type==='success'?'bg-green-500':'bg-red-500'}`; t.innerText = msg; document.body.appendChild(t); setTimeout(()=>t.remove(), 2800); }
    window.toggleAdmin = function() { if(document.body.classList.contains('is-admin')){ document.body.classList.remove('is-admin'); document.getElementById('adminBtn').textContent='ğŸ”’'; localStorage.setItem('isAdmin', 'false'); showToast('Admin Logout'); } else { document.getElementById('loginModal').classList.remove('hidden'); } }
    window.submitLogin = function() { if(document.getElementById('adminPassInput').value === 'hudan123'){ document.body.classList.add('is-admin'); document.getElementById('adminBtn').textContent='ğŸ”“'; localStorage.setItem('isAdmin', 'true'); closeAdminModal(); showToast('Selamat datang, Baginda Raja!'); } else { showToast('Password Salah','error'); } }
    window.closeAdminModal = function() { document.getElementById('loginModal').classList.add('hidden'); }
    
    initializeAppUI();
  </script>
 </body>
</html>
